{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Overview","text":"<p>Start of something big</p>"},{"location":"glossary/","title":"Glossary (Enums &amp; Constants)","text":"<p>Central reference for magic values, enums and indices used across the DRS format and Blender tools. Values are shown in decimal and hex.</p>"},{"location":"glossary/#magicvalues","title":"MagicValues","text":"<p>These are the <code>NodeInformation.magic</code> identifiers used to tag blocks in the container.</p> Name Decimal Hex <code>CDspJointMap</code> -1340635850 0xB01E64C6 <code>CGeoMesh</code> 100449016 0x05FBDF08 <code>CGeoOBBTree</code> -933519637 0xC88A90FB <code>CSkSkinInfo</code> -761174227 0xD2541ADD <code>CDspMeshFile</code> -1900395636 0x8EDCF4A4 <code>DrwResourceMeta</code> -183033339 0xF51F0ED5 <code>collisionShape</code> 268607026 0x1006C5F2 <code>CGeoPrimitiveContainer</code> 1396683476 0x5342C5D4 <code>CSkSkeleton</code> -2110567991 0x8192C3B9 <code>CDrwLocatorList</code> 735146985 0x2BC5D0C9 <code>AnimationSet</code> -475734043 0xE3A5C3E5 <code>AnimationTimings</code> -1403092629 0xAC56E6BB <code>EffectSet</code> 688490554 0x2912AE1A <p>Note: exact hex is shown as two\u2019s complement for negatives. The decimal values are what you actually read/write.</p>"},{"location":"glossary/#animationtype","title":"AnimationType","text":"<p>Used in <code>AnimationTimings</code> / ability timing metadata.</p> Name Value <code>CastResolve</code> 0 <code>Spawn</code> 1 <code>Melee</code> 2 <code>Channel</code> 3 <code>ModeSwitch</code> 4 <code>WormMovement</code> 5"},{"location":"glossary/#locatorclass","title":"LocatorClass","text":"<p>Semantic meaning for locators in <code>CDrwLocatorList</code>.</p> ID Name Notes 0 <code>HealthBar</code> Health bar offset 1 <code>DestructiblePart</code> Static module/parts 2 <code>Construction</code> \u201cPivotOffset\u201d; construction pieces 3 <code>Turret</code> Animated child unit (plays SKA) 4 <code>FxbIdle</code> WormDecal; idle effects 5 <code>Wheel</code> Animated child (idle/walk/run) 6 <code>StaticPerm</code> FXNode; permanent building/object FX 7 <code>Unknown7</code> \u2014 8 <code>DynamicPerm</code> Unit permanent effects \u2192 FXB 9 <code>DamageFlameSmall</code> Building damage fire (small) 10 <code>DamageFlameSmallSmoke</code> Damage smoke 11 <code>DamageFlameLarge</code> Building damage fire (large) 12 <code>DamageSmokeOnly</code> Damage smoke only 13 <code>DamageFlameHuge</code> Building damage fire (huge) 14 <code>SpellCast</code> Legacy/unused 15 <code>SpellHitAll</code> Legacy/unused 16 <code>Hit</code> Hit point for attacks/spells 29 <code>Projectile_Spawn</code> Projectile/effect spawn point"},{"location":"drs/animationset/","title":"AnimationSet","text":"<p>Defines the collection of animations available to a model, linking specific game states or actions (like \"idle\", \"walk\", \"attack\") to animation files (<code>.ska</code>). It also includes parameters controlling animation playback behavior and Inverse Kinematics (IK). \ud83c\udfac</p>"},{"location":"drs/animationset/#overview","title":"Overview","text":"<ul> <li>Purpose: Manages all skeletal animations for a unit or animated object, defining which <code>.ska</code> file plays for which action, and includes settings like default movement speeds and IK constraints.</li> <li>Where it appears: Included in animated model types: <code>AnimatedUnit</code>, <code>AnimatedObjectNoCollision</code>, <code>AnimatedObjectCollision</code>. See <code>WriteOrder</code>.</li> <li>Engine impact: Crucial for animation playback. Contains default speeds used by movement logic, IK constraints for targeting/aiming, and links to the actual animation data.</li> </ul>"},{"location":"drs/animationset/#structure","title":"Structure","text":"Field Type Description <code>length</code> <code>int32</code> Length of the <code>magic</code> string (always 11). <code>magic</code> <code>string</code> Magic identifier string, always \"Battleforge\". <code>version</code> <code>int32</code> Format version, typically <code>6</code>. <code>default_run_speed</code> <code>float</code> Default movement speed when running. <code>default_walk_speed</code> <code>float</code> Default movement speed when walking. <code>revision</code> <code>int32</code> Sub-version or revision number, often <code>0</code> for objects, higher for units (e.g., <code>6</code>). Controls optional fields. <code>mode_change_type</code> <code>uint8</code> (Optional, <code>revision &gt;= 2</code>) Unknown flag related to mode changes. <code>hovering_ground</code> <code>uint8</code> (Optional, <code>revision &gt;= 2</code>) Flag related to hovering units. <code>fly_bank_scale</code> <code>float</code> (Optional, <code>revision &gt;= 5</code>) Scale factor for banking during flight. <code>fly_accel_scale</code> <code>float</code> (Optional, <code>revision &gt;= 5</code>) Scale factor for acceleration during flight. <code>fly_hit_scale</code> <code>float</code> (Optional, <code>revision &gt;= 5</code>) Scale factor related to being hit during flight. <code>allign_to_terrain</code> <code>uint8</code> (Optional, <code>revision &gt;= 6</code>) Flag to align the model to terrain slope. <code>mode_animation_key_count</code> <code>int32</code> Number of animation keys defined. <code>mode_animation_keys</code> <code>List[ModeAnimationKey]</code> List of keys linking game states/actions to animation variants. See ModeAnimationKey. <code>has_atlas</code> <code>int16</code> (Optional, <code>version &gt;= 3</code>) Flag indicating presence of IK data (0, 1, or 2). <code>atlas_count</code> <code>int32</code> (Optional, <code>has_atlas &gt;= 1</code>) Number of IK Atlas entries. <code>ik_atlases</code> <code>List[IKAtlas]</code> (Optional, <code>has_atlas &gt;= 1</code>) List of Inverse Kinematics constraints per bone. See IKAtlas. <code>uk_len</code> <code>int32</code> (Optional, <code>has_atlas &gt;= 2</code>) Length of <code>uk_ints</code> array. <code>uk_ints</code> <code>List[int32]</code> (Optional, <code>has_atlas &gt;= 2</code>) Unknown integer array. <code>subversion</code> <code>int16</code> (Optional, <code>version &gt;= 4</code>) Sub-version controlling marker/unknown struct presence. Typically <code>2</code>. <code>animation_marker_count</code> <code>int32</code> (Optional, <code>subversion == 2</code>) Number of animation marker sets. <code>animation_marker_sets</code> <code>List[AnimationMarkerSet]</code> (Optional, <code>subversion == 2</code>) Data linking animation events to specific points in time/space. See AnimationMarkerSet. <code>unknown</code> <code>int32</code> (Optional, <code>subversion == 1</code>) Count for <code>unknown_structs</code>. <code>unknown_structs</code> <code>List[UnknownStruct]</code> (Optional, <code>subversion == 1</code>) Unknown structure list. See UnknownStruct."},{"location":"drs/animationset/#modeanimationkey","title":"ModeAnimationKey","text":"<p>Links a game state/action (identified by <code>file</code>, often conceptually like \"Idle\" or \"Attack\") to one or more animation variants (<code>.ska</code> files).</p> Field Type Description <code>type</code> <code>int32</code> Internal type identifier (often <code>6</code>). <code>length</code> <code>int32</code> Length of the <code>magic</code> string (always 11). <code>file</code> <code>string</code> Always \"Battleforge\". <code>unknown</code> <code>int32</code> Unknown integer. <code>unknown2</code> <code>List[uint8]</code> or <code>int32</code> Varies based on <code>type</code>. Often a single <code>int32</code>. <code>vis_job</code> <code>int16</code> (If <code>type == 6</code>) Related to visual state or job type. Export filter in <code>create_animation_set</code> removes keys where <code>vis_job != 0</code> for non-unit types. <code>unknown3</code> <code>int32</code> (If <code>type == 6</code>) Unknown integer. <code>special_mode</code> <code>int16</code> (If <code>type &lt;= 5</code> or <code>6</code>) Identifier for a special animation mode or state. <code>variant_count</code> <code>int32</code> Number of animation variants associated with this key. <code>animation_set_variants</code> <code>List[AnimationSetVariant]</code> List of variants, each pointing to a <code>.ska</code> file and defining playback parameters. See AnimationSetVariant. A key must have at least one valid variant to be saved during export."},{"location":"drs/animationset/#animationsetvariant","title":"AnimationSetVariant","text":"<p>Defines a single animation file (<code>.ska</code>) that can be played for a <code>ModeAnimationKey</code>, along with playback settings.</p> Field Type Description <code>version</code> <code>int32</code> Format version for this variant structure, typically <code>7</code>. <code>weight</code> <code>int32</code> Likelihood of this variant being chosen if multiple exist for a key (e.g., 100). <code>length</code> <code>int32</code> Length of the animation <code>file</code> name string. <code>file</code> <code>string</code> Path to the <code>.ska</code> animation file (relative to the DRS). Must end with <code>.ska</code>. <code>start</code> <code>float</code> (Optional, <code>version &gt;= 4</code>) Start time within the <code>.ska</code> file (normalized 0.0-1.0 or actual seconds?). <code>end</code> <code>float</code> (Optional, <code>version &gt;= 4</code>) End time within the <code>.ska</code> file (normalized 0.0-1.0 or actual seconds?). <code>allows_ik</code> <code>uint8</code> (Optional, <code>version &gt;= 5</code>) Flag indicating if Inverse Kinematics can be applied during this animation (0 or 1). <code>force_no_blend</code> <code>uint8</code> (Optional, <code>version &gt;= 7</code>) Flag to prevent blending into/out of this animation (0 or 1)."},{"location":"drs/animationset/#ikatlas","title":"IKAtlas","text":"<p>Defines Inverse Kinematics constraints for a specific bone.</p> Field Type Description <code>identifier</code> <code>int32</code> Bone ID (from <code>CSkSkeleton</code>) that these constraints apply to. <code>version</code> <code>int16</code> Format version, typically <code>2</code>. <code>axis</code> <code>int32</code> (Optional, <code>version &gt;= 1</code>) Axis identifier, usually <code>2</code>. <code>chain_order</code> <code>int32</code> (Optional, <code>version &gt;= 1</code>) Order of evaluation within an IK chain. <code>constraints</code> <code>List[Constraint]</code> (Optional, <code>version &gt;= 1</code>) List of three constraints (one for each axis: X, Y, Z). See Constraint. <code>purpose_flags</code> <code>int16</code> (Optional, <code>version &gt;= 2</code>) Flags indicating the purpose or usage context of these constraints."},{"location":"drs/animationset/#constraint","title":"Constraint","text":"<p>Specifies rotational limits and damping for a single axis of a bone within an <code>IKAtlas</code>. Angles are stored in radians.</p> Field Type Description <code>revision</code> <code>int16</code> Format revision, typically <code>1</code>. <code>left_angle</code> <code>float</code> (Optional, <code>revision == 1</code>) Minimum rotation angle (radians). <code>right_angle</code> <code>float</code> (Optional, <code>revision == 1</code>) Maximum rotation angle (radians). <code>left_damp_start</code> <code>float</code> (Optional, <code>revision == 1</code>) Angle where damping starts (min side). <code>right_damp_start</code> <code>float</code> (Optional, <code>revision == 1</code>) Angle where damping starts (max side). <code>damp_ratio</code> <code>float</code> (Optional, <code>revision == 1</code>) Damping factor (0.0 to 1.0)."},{"location":"drs/animationset/#animationmarkerset","title":"AnimationMarkerSet","text":"<p>Groups animation markers (events) related to a specific animation file.</p> Field Type Description <code>anim_id</code> <code>int32</code> Identifier for the animation this marker set belongs to. <code>length</code> <code>int32</code> Length of the <code>name</code> string. <code>name</code> <code>string</code> Name of the associated animation file (e.g., \"skel_human_idle1.ska\"). <code>animation_marker_id</code> <code>uint32</code> Unique ID for this marker set. <code>marker_count</code> <code>int32</code> Number of markers in this set (typically <code>1</code>). <code>animation_markers</code> <code>List[AnimationMarker]</code> List containing the actual marker event data. Usually only one marker per set. See AnimationMarker."},{"location":"drs/animationset/#animationmarker","title":"AnimationMarker","text":"<p>Defines a specific event point within an animation, including time, position, and direction.</p> Field Type Description <code>is_spawn_animation</code> <code>int32</code> Flag indicating if this marker relates to a spawn animation (0 or 1). <code>time</code> <code>float</code> Time point within the animation where the event occurs (likely in seconds). <code>direction</code> <code>Vector3</code> Direction vector associated with the event. See Vector3. <code>position</code> <code>Vector3</code> Position vector associated with the event. See Vector3."},{"location":"drs/animationset/#unknownstruct-appears-if-subversion-1","title":"UnknownStruct (Appears if <code>subversion == 1</code>)","text":"<p>An undocumented structure.</p> Field Type Description <code>unknown</code> <code>int32</code> Unknown integer. <code>length</code> <code>int32</code> Length of the <code>name</code> string. <code>name</code> <code>string</code> Unknown string. <code>unknown2</code> <code>int32</code> Unknown integer. <code>unknown3</code> <code>int32</code> Count for <code>unknown_structs</code> list. <code>unknown_structs</code> <code>List[UnknownStruct2]</code> List of nested unknown structures. See UnknownStruct2."},{"location":"drs/animationset/#unknownstruct2-appears-if-subversion-1","title":"UnknownStruct2 (Appears if <code>subversion == 1</code>)","text":"<p>A nested undocumented structure within <code>UnknownStruct</code>.</p> Field Type Description <code>unknown_ints</code> <code>List[int32]</code> Array of 5 unknown integers."},{"location":"drs/animationset/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>Blender Workflow:<ul> <li>Animation Set Editor: The primary way to manage <code>AnimationSet</code> data is through the dedicated Animation Set Editor UI panel in the addon. This editor stores the configuration in a JSON blob (<code>ANIM_BLOB_KEY</code>) attached to the main model collection.</li> <li>JSON Blob: This blob holds lists for <code>mode_keys</code> (linking conceptual names like \"Idle\" to <code>.ska</code> files and variants) and <code>marker_sets</code> (defining animation events). It also stores top-level parameters like default speeds and IK flags. The blob is the authoritative source during export.</li> <li>Export (<code>create_animation_set</code>): The exporter reads the JSON blob from the collection. It reconstructs the <code>AnimationSet</code> structure, including <code>ModeAnimationKey</code>, <code>AnimationSetVariant</code>, <code>AnimationMarkerSet</code>, and <code>AnimationMarker</code> objects based on the blob data.<ul> <li><code>.ska</code> File Links: The <code>AnimationSetVariant.file</code> field is populated from the blob. The exporter ensures it ends with <code>.ska</code>.</li> <li>IK Constraints: <code>IKAtlas</code> and <code>Constraint</code> data is gathered directly from <code>LIMIT_ROTATION</code> constraints on the Armature's Pose Bones in Blender (<code>collect_ik_atlases_from_blender</code>).</li> </ul> </li> <li>Import (<code>persist_animset_blob_on_collection</code>): The importer reads the <code>AnimationSet</code> from the DRS file, converts it into the JSON blob format (<code>animset_to_blob</code>), and stores this blob on the imported model's collection. The Animation Set Editor UI then reads from this blob. IK constraints are applied to the Armature's Pose Bones (<code>import_animation_ik_atlas</code>).</li> </ul> </li> <li>In-Game Function: The game engine uses <code>AnimationSet</code> to know which <code>.ska</code> animation to play based on the unit's current state (idle, walking, attacking, etc.). It uses the default speeds for movement calculations, applies IK constraints for aiming or foot placement, and triggers events based on <code>AnimationMarker</code> data.</li> </ul>"},{"location":"drs/animationset/#validation-rules","title":"Validation Rules","text":"Rule Why <code>magic == \"Battleforge\"</code> and <code>length == 11</code> Confirms block identity. <code>version</code> is supported (e.g., 6) Ensures correct reading of optional fields based on <code>version</code>/<code>revision</code>. Counts (<code>mode_animation_key_count</code>, etc.) match list lengths Prevents read errors and ensures data integrity. <code>AnimationSetVariant.file</code> points to existing <code>.ska</code> files Required for animations to play correctly. <code>IKAtlas.identifier</code> refers to a valid bone ID in <code>CSkSkeleton</code> IK constraints must apply to existing bones."},{"location":"drs/animationset/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: Referenced via <code>NodeInformation</code> in the DRS header. See Header.</li> <li>Skeleton: Uses bone identifiers from <code>CSkSkeleton</code> for IK constraints. See CSkSkeleton.</li> <li>Animation Timings: Works alongside <code>AnimationTimings</code> which defines timing details for certain animation types. See AnimationTimings.</li> <li>Animation Data: Links to external <code>.ska</code> files containing the actual animation curves.</li> <li>Animation Set Editor: Interacts with the JSON blob (<code>ANIM_BLOB_KEY</code>) managed by the editor panel.</li> </ul>"},{"location":"drs/animationset/#nice-to-know","title":"Nice to know","text":"<ul> <li>Magic Value: <code>AnimationSet = -475734043</code> (0xE3A63FE5). See Glossary \u2192 MagicValues.</li> <li>Blob is King: Edits made directly to Blender Actions or Armature constraints (other than IK limits) might not be reflected on export unless the Animation Set Editor blob is updated accordingly. The blob stored on the collection is the primary source of truth for export.</li> <li>Animated Object Filter: For <code>AnimatedObjectCollision</code> / <code>AnimatedObjectNoCollision</code> types, the exporter filters out <code>ModeAnimationKey</code> entries where <code>vis_job</code> is not <code>0</code>.</li> </ul>"},{"location":"drs/animationtimings/","title":"AnimationTimings","text":"<p>Stores precise timing information (start/end in milliseconds) for specific types of animations, often used to synchronize gameplay events like ability casts or melee strikes with the visual animation. \u23f1\ufe0f</p>"},{"location":"drs/animationtimings/#overview","title":"Overview","text":"<ul> <li>Purpose: Defines key time points within animations for gameplay logic, such as when an ability effect should trigger (<code>resolve_ms</code>) relative to the animation starting (<code>cast_ms</code>).</li> <li>Where it appears: Included in animated model types that typically perform actions: <code>AnimatedUnit</code>, <code>AnimatedObjectNoCollision</code>, <code>AnimatedObjectCollision</code>. See <code>WriteOrder</code>.</li> <li>Engine impact: Used by the gameplay systems (e.g., combat, abilities) to synchronize actions and effects precisely with the visual animation playback. Incorrect timings can lead to abilities feeling laggy or effects appearing at the wrong moment.</li> </ul>"},{"location":"drs/animationtimings/#structure","title":"Structure","text":"Field Type Description <code>magic</code> <code>int32</code> Internal block identifier, should be <code>1650881127</code>. <code>version</code> <code>int16</code> Format version, typically <code>4</code> (can also be <code>3</code> in older data). Controls structure interpretation. <code>animation_timing_count</code> <code>int16</code> Number of <code>AnimationTiming</code> entries in the list. <code>animation_timings</code> <code>List[AnimationTiming]</code> List of timing definitions, grouped by animation type and tag ID. See AnimationTiming. <code>struct_v3</code> <code>StructV3</code> An additional structure at the end, purpose unclear. See StructV3."},{"location":"drs/animationtimings/#animationtiming","title":"AnimationTiming","text":"<p>Groups timing variants for a specific type of animation and tag.</p> Field Type Description <code>animation_type</code> <code>int32</code> Category of animation this timing applies to (e.g., <code>0</code>=CastResolve, <code>1</code>=Spawn, <code>2</code>=Melee). See <code>AnimationType</code> in <code>drs_definitions.py</code> / Glossary. <code>animation_tag_id</code> <code>int32</code> (Optional, <code>version &gt;= 2</code>) Identifier likely linking this timing to a specific ability or action variant. <code>is_enter_mode_animation</code> <code>int16</code> (Optional, <code>version &gt;= 2</code>) Flag, often <code>1</code>. Purpose unclear, possibly related to state transitions. <code>variant_count</code> <code>int16</code> Number of timing variants defined for this type/tag combination. <code>timing_variants</code> <code>List[TimingVariant]</code> List of actual timing data variants. See TimingVariant."},{"location":"drs/animationtimings/#timingvariant","title":"TimingVariant","text":"<p>Defines one possible set of timings for an <code>AnimationTiming</code> entry, often weighted.</p> Field Type Description <code>weight</code> <code>uint8</code> Likelihood of this variant being chosen (e.g., <code>100</code>). <code>variant_index</code> <code>uint8</code> (Optional, <code>version == 4</code>) Index for this specific variant. <code>timing_count</code> <code>uint16</code> Number of <code>Timing</code> entries in this variant (often just <code>1</code>). <code>timings</code> <code>List[Timing]</code> List containing the actual millisecond timings and related data. See Timing."},{"location":"drs/animationtimings/#timing","title":"Timing","text":"<p>Specifies the core timing data in milliseconds, along with direction and a marker link.</p> Field Type Description <code>cast_ms</code> <code>int32</code> Time in milliseconds (relative to animation start) when the action/cast begins. <code>resolve_ms</code> <code>int32</code> Time in milliseconds when the main effect/impact of the action occurs (e.g., damage dealt, projectile fired). <code>direction</code> <code>Vector3</code> Direction vector associated with the timing event. See Vector3. <code>animation_marker_id</code> <code>uint32</code> ID linking this timing event back to a specific marker defined in the <code>AnimationSet</code>. See AnimationMarkerSet."},{"location":"drs/animationtimings/#structv3","title":"StructV3","text":"<p>An unclear structure appearing at the end of the <code>AnimationTimings</code> block.</p> Field Type Description <code>length</code> <code>int32</code> Count, usually <code>1</code>. <code>unknown</code> <code>List[int32]</code> List of 2 unknown integers."},{"location":"drs/animationtimings/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>Blender Workflow:<ul> <li>Animation Set Editor: Timings are managed exclusively through the Animation Set Editor UI panel, specifically in the \"Timings\" section. Artists define entries based on <code>Animation Type</code> (CastResolve, Melee, etc.) and <code>Tag ID</code>.</li> <li>Editing: Within the editor, you set the <code>Cast Ms</code>, <code>Resolve Ms</code>, <code>Direction</code>, and link it to an <code>Animation Marker ID</code> (which must correspond to an ID defined in the \"Marker Sets\" section of the same editor).</li> <li>JSON Blob: Like <code>AnimationSet</code> data, the timings configuration is stored in the JSON blob (<code>ANIM_BLOB_KEY</code>) attached to the main model collection (under the <code>\"timings\"</code> key). This blob is the authoritative source for export.</li> <li>Export (<code>create_animation_timings</code>): The exporter reads the <code>\"timings\"</code> list from the JSON blob and reconstructs the <code>AnimationTimings</code> structure, including all substructures, based on the editor's data (<code>blob_to_animationtimings</code>). If no timings are defined in the blob, this block might be skipped during export (depending on model type requirements).</li> <li>Import (<code>animtimings_to_blob</code>): The importer reads the <code>AnimationTimings</code> block, converts it to the JSON list format, and stores it within the main animation blob (<code>ANIM_BLOB_KEY</code>) on the collection. The editor UI then loads this data.</li> </ul> </li> <li>In-Game Function: The game uses these timings to synchronize gameplay events. For example, in a melee attack animation (<code>animation_type = 2</code>), <code>cast_ms</code> might be when the weapon starts swinging, and <code>resolve_ms</code> is the exact moment the weapon should hit and deal damage. The <code>direction</code> might indicate the attack's vector, and <code>animation_marker_id</code> links it to potentially other data like sound or visual effect triggers defined in <code>AnimationSet</code>.</li> </ul>"},{"location":"drs/animationtimings/#validation-rules","title":"Validation Rules","text":"Rule Why <code>magic == 1650881127</code> Confirms correct block type. <code>version</code> is supported (e.g., 3, 4) Ensures correct structure interpretation (presence of <code>animation_tag_id</code>, etc.). Counts match list lengths Prevents read errors and ensures data integrity. <code>resolve_ms &gt;= cast_ms</code> Logically, the effect resolution shouldn't happen before the cast starts. <code>animation_marker_id</code> exists in <code>AnimationSet</code> Ensures the timing event can be correctly linked to its marker context."},{"location":"drs/animationtimings/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: Referenced via <code>NodeInformation</code> in the DRS header. See Header.</li> <li>Animation Set: Works in conjunction with <code>AnimationSet</code>, particularly linking via <code>Timing.animation_marker_id</code>. See AnimationSet.</li> <li>Animation Types: The <code>animation_type</code> values are defined in <code>drs_definitions.py</code> (e.g., <code>AnimationType['Melee'] = 2</code>). See Glossary (once added).</li> <li>Common Structures: Uses <code>Vector3</code>. See Common Structures.</li> </ul>"},{"location":"drs/animationtimings/#nice-to-know","title":"Nice to know","text":"<ul> <li>Magic Value: <code>AnimationTimings = -1403092629</code> (0xAC5E916B). See Glossary \u2192 MagicValues.</li> <li>Editor is Key: Timings are complex and directly tied to gameplay feel. Accurate configuration via the Animation Set Editor is crucial.</li> <li>Animated Object Fix: For non-unit animated objects (<code>AnimatedObjectNoCollision</code>, <code>AnimatedObjectCollision</code>), the exporter forces <code>version = 3</code> and removes all timing entries, as these object types typically don't use them.</li> </ul>"},{"location":"drs/cdrwlocatorlist/","title":"CDrwLocatorList","text":"<p>Stores a list of locators, which are points of interest on a model used for attaching effects, modules, or defining gameplay-relevant positions (like health bars or projectile origins). \ud83d\udccd</p>"},{"location":"drs/cdrwlocatorlist/#overview","title":"Overview","text":"<ul> <li>Purpose: Defines attachment points and functional locations on animated units or buildings.</li> <li>Where it appears: Primarily used in <code>AnimatedUnit</code> models (<code>WriteOrder</code>). Static and simpler animated objects usually don't have this block.</li> <li>Engine impact: Used at runtime to spawn effects (<code>.fxb</code> files), attach other models (like turrets or destructible parts via <code>.module</code> files), position UI elements (health bars), and define interaction points (hit locations, projectile spawns).</li> </ul>"},{"location":"drs/cdrwlocatorlist/#structure","title":"Structure","text":"Field Type Description <code>magic</code> <code>int32</code> Internal block identifier, should be <code>281702437</code>. <code>version</code> <code>int32</code> Format version (e.g., <code>5</code>). Determines if <code>uk_int</code> in <code>SLocator</code> exists. <code>length</code> <code>int32</code> Number of locators in the list. <code>slocators</code> <code>List[SLocator]</code> The actual list of locator entries. See SLocator."},{"location":"drs/cdrwlocatorlist/#slocator","title":"SLocator","text":"<p>Defines a single locator point.</p> Field Type Description <code>cmat_coordinate_system</code> <code>CMatCoordinateSystem</code> Local transformation (rotation + position) relative to its parent (world or bone). See CMatCoordinateSystem. <code>class_id</code> <code>int32</code> Type identifier determining the locator's function (e.g., <code>0</code> for HealthBar, <code>3</code> for Turret, <code>8</code> for DynamicPerm effects). See LocatorClass dictionary for full list. <code>bone_id</code> <code>int32</code> Identifier of the bone this locator is attached to (from <code>CSkSkeleton</code>). If <code>-1</code>, it's attached to the object's root (world space relative to the model origin). <code>file_name_length</code> <code>int32</code> Length of the <code>file_name</code> string. <code>file_name</code> <code>string</code> Associated file path (e.g., an effect <code>.fxb</code> or module <code>.module</code>/<code>.bms</code>/<code>.drs</code>) used by this locator, if applicable. Can be empty. <code>uk_int</code> <code>int32</code> Unknown integer, present only if <code>CDrwLocatorList.version</code> is <code>5</code> or higher. Often <code>-1</code>. <code>class_type</code> <code>string</code> (derived) Human-readable type derived from <code>class_id</code> during import/export (e.g., \"HealthBar\", \"Turret\"). Not stored in the file."},{"location":"drs/cdrwlocatorlist/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>Blender Workflow:<ul> <li>Representation: Locators are typically represented as Empty objects in Blender. Their name often reflects their type (e.g., <code>Locator_HealthBar</code>, <code>Locator_Turret</code>).</li> <li>Locator Editor: The addon provides a dedicated Locator Editor UI. This editor stores the locator data (type, bone attachment, file name) in a JSON blob (<code>BLOB_KEY</code>) attached to the main model collection. This blob is the authoritative source during export.</li> <li>Export (<code>create_cdrw_locator_list</code>): The exporter reads the JSON blob from the collection. If the blob is missing or invalid, it tries to reconstruct locators by scanning for Empty objects named <code>Locator_*</code> or objects with a <code>UID_KEY</code> custom property.</li> <li>Transformation:<ul> <li>If a locator is parented to a Bone in Blender (<code>parent_type == 'BONE'</code>), its local transform relative to that bone is stored. <code>SLocator.bone_id</code> is set to the bone's identifier from <code>CSkSkeleton</code>.</li> <li>If not parented to a bone, its world space transform (relative to the <code>GameOrientation</code> empty, if present, otherwise relative to the Blender world origin) is stored, and <code>SLocator.bone_id</code> is set to <code>-1</code>.</li> </ul> </li> <li>Import (<code>process_slocator_import</code>): The importer creates Blender Empties (or loads linked models for types like <code>DestructiblePart</code>, <code>Wheel</code>) based on the <code>SLocator</code> data. If <code>bone_id</code> is valid, it parents the Empty to the corresponding bone in the Armature. Otherwise, it places the Empty in world space. A unique ID (<code>UID_KEY</code>) is stored on the created objects to link them back to the editor data.</li> </ul> </li> <li>In-Game Function: The <code>class_id</code> tells the game engine what to do at the locator's position and orientation. For example, attach a turret model, spawn a projectile effect, or place the unit's health bar offset.</li> </ul>"},{"location":"drs/cdrwlocatorlist/#validation-rules","title":"Validation Rules","text":"Rule Why <code>magic == 281702437</code> Confirms correct block type. <code>version</code> is supported (e.g., 5) Ensures correct reading of <code>SLocator</code> fields like <code>uk_int</code>. <code>length == len(slocators)</code> Internal consistency. <code>bone_id</code> is valid (<code>-1</code> or exists in <code>CSkSkeleton</code>) Prevents attaching locators to non-existent bones. <code>file_name_length</code> matches actual string length Prevents read errors. <code>cmat_coordinate_system</code> is valid (orthonormal rotation) Ensures correct orientation in-game."},{"location":"drs/cdrwlocatorlist/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: Referenced via <code>NodeInformation</code> in the DRS header. See Header.</li> <li>Skeleton: Uses <code>bone_id</code> values which are identifiers defined in <code>CSkSkeleton</code>. See CSkSkeleton.</li> <li>Common Structures: Uses <code>CMatCoordinateSystem</code>. See Common Structures.</li> <li>Locator Classes: See LocatorClass dictionary for full list. </li> <li>Locator Editor: Interacts with the JSON blob managed by the Locator Editor panel.</li> </ul>"},{"location":"drs/cdrwlocatorlist/#nice-to-know","title":"Nice to know","text":"<ul> <li>Magic Value: <code>CDrwLocatorList = 735146985</code> (0x2BD8B3E9). See Glossary \u2192 MagicValues.</li> <li>Editor is Key: For reliable export, always use the Locator Editor UI panel to manage locators rather than relying solely on Blender object naming and parenting, as the JSON blob takes precedence.</li> </ul>"},{"location":"drs/cdspjointmap/","title":"CDspJointMap","text":"<p>Maps local bone indices used within a mesh (<code>CDspMeshFile</code>) to the global bone identifiers defined in the skeleton (<code>CSkSkeleton</code>). This acts as a lookup table for skinning.</p>"},{"location":"drs/cdspjointmap/#overview","title":"Overview","text":"<ul> <li>Purpose: Links the vertex weights (which refer to a small, mesh-specific set of bones) to the full skeleton's bone hierarchy. Essential for correct skinning deformation. \ud83e\uddb4</li> <li>Where it appears: Present in all model types (<code>AnimatedUnit</code>, <code>StaticObjectCollision</code>, <code>StaticObjectNoCollision</code>, <code>AnimatedObjectNoCollision</code>, <code>AnimatedObjectCollision</code>). Appears early in the <code>WriteOrder</code>.</li> <li>Engine impact: Directly used by the skinning system to apply bone transformations to vertices.</li> </ul>"},{"location":"drs/cdspjointmap/#structure","title":"Structure","text":"Field Type Description <code>version</code> <code>int32</code> Format version, typically <code>1</code>. <code>joint_group_count</code> <code>int32</code> Number of joint groups (usually matches the number of meshes in <code>CDspMeshFile</code>). <code>joint_groups</code> <code>List[JointGroup]</code> List containing one group per mesh."},{"location":"drs/cdspjointmap/#jointgroup","title":"JointGroup","text":"<p>Contains the mapping for a single mesh.</p> Field Type Description <code>joint_count</code> <code>int32</code> Number of joints (bones) referenced by this specific mesh. <code>joints</code> <code>List[int16]</code> Array mapping the mesh's local bone index (used in <code>MeshData</code> revision 12 <code>bone_indices</code>) to the global bone identifier (from <code>CSkSkeleton</code>)."},{"location":"drs/cdspjointmap/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>Blender Workflow: This block is created automatically by the exporter (<code>create_cdsp_joint_map</code> in <code>drs_utility.py</code>) when exporting a skinned mesh.</li> <li>How it works: When exporting, the tool gathers all unique bones that influence each mesh piece. It creates a compact list (<code>JointGroup.joints</code>) containing only the global IDs of those specific bones.</li> <li>Vertex Weights: The skinning data (<code>CSkSkinInfo</code> or <code>MeshData</code> revision 12) stores local indices (0, 1, 2...) referring to this <code>JointGroup.joints</code> list. The game engine uses this map to find the correct global bone ID from the local index during animation.</li> <li>Root Reference (<code>root_ref</code>): The exporter tracks which local index corresponds to the root bone (ID 0) and stores this information internally (<code>mesh_bone_data[\"root_ref\"]</code>) to correctly update vertex weights that might reference the root bone implicitly. Artists don't need to manage this directly. \u2705</li> </ul>"},{"location":"drs/cdspjointmap/#validation-rules","title":"Validation Rules","text":"Rule Why <code>version == 1</code> Ensures the expected format. <code>joint_group_count == len(joint_groups)</code> Internal consistency. <code>joint_count == len(joints)</code> for each group Joint array must match its count. Referenced global bone IDs exist in <code>CSkSkeleton</code> Prevents mapping to non-existent bones."},{"location":"drs/cdspjointmap/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: Referenced via <code>NodeInformation</code> in the DRS header. See Header.</li> <li>Mesh Data: Corresponds to meshes in <code>CDspMeshFile</code>. See CDspMeshFile.</li> <li>Skinning Data: Provides the global IDs for local indices used in <code>CSkSkinInfo</code> or <code>MeshData</code> (rev 12). See CSkSkinInfo and CDspMeshFile.</li> <li>Skeleton: Global bone identifiers come from <code>CSkSkeleton</code>. See CSkSkeleton.</li> </ul>"},{"location":"drs/cdspjointmap/#nice-to-know","title":"Nice to know","text":"<ul> <li>Magic Value: <code>CDspJointMap = -1340635850</code> (0xB016E536). See Glossary \u2192 MagicValues.</li> <li>Even static models often contain a <code>CDspJointMap</code>, sometimes empty or mapping just a root bone if they were derived from animated assets.</li> </ul>"},{"location":"drs/cdspmeshfile/","title":"CDspMeshFile","text":"<p>Top-level mesh container used in DRS files. It wraps one or more <code>BattleforgeMesh</code> entries and includes a file-level bounding box and three trailing points. The NodeInformation.magic for this class is <code>CDspMeshFile = -1900395636 (0x8EDCF4A4)</code>. Inside the payload, the internal block header uses <code>magic = 1314189598</code>.</p>"},{"location":"drs/cdspmeshfile/#overview","title":"Overview","text":"<ul> <li>Purpose: Holds one or more renderable mesh blocks (<code>BattleforgeMesh</code>) in a single DRS entry.  </li> <li>Where it shows up: Used in any mesh-based model (static objects, animated geometry).  </li> <li>Engine impact: Provides vertex and face data, material links, and LOD information for visual rendering.</li> </ul>"},{"location":"drs/cdspmeshfile/#structure","title":"Structure","text":"Field Type Description <code>magic</code> <code>int32</code> Must be <code>1314189598</code>. <code>zero</code> <code>int32</code> Always <code>0</code>. <code>mesh_count</code> <code>int32</code> Number of contained meshes. <code>bounding_box_lower_left_corner</code> Vector3 Global AABB min. <code>bounding_box_upper_right_corner</code> Vector3 Global AABB max. <code>meshes</code> <code>BattleforgeMesh[mesh_count]</code> Mesh entries. <code>some_points</code> <code>Vector4[3]</code> Three 4D vectors stored at the end."},{"location":"drs/cdspmeshfile/#battleforgemesh","title":"BattleforgeMesh","text":"<p>A single mesh entry with faces, vertex data, bounding box, and material information.</p> Field Type Description <code>vertex_count</code> <code>int32</code> Number of vertices. <code>face_count</code> <code>int32</code> Number of triangles. <code>faces</code> <code>Face[face_count]</code> List of triangles (3\u00d7<code>uint16</code> indices). <code>mesh_count</code> <code>uint8</code> Number of vertex streams. <code>mesh_data</code> <code>MeshData[mesh_count]</code> Vertex streams. <code>bounding_box_lower_left_corner</code> Vector3 Local AABB min. <code>bounding_box_upper_right_corner</code> Vector3 Local AABB max. <code>material_id</code> <code>int16</code> Material index. <code>material_parameters</code> <code>int32</code> Switch controlling extra trailing blocks."},{"location":"drs/cdspmeshfile/#conditional-trailing-blocks","title":"Conditional trailing blocks","text":"<p>Depending on <code>material_parameters</code>, additional structures follow:</p> <ul> <li>When <code>-86061050</code>:</li> <li><code>material_stuff:int32</code>, <code>bool_parameter:int32</code></li> <li><code>textures</code></li> <li><code>refraction</code></li> <li><code>materials</code></li> <li><code>level_of_detail</code></li> <li><code>empty_string</code></li> <li> <p><code>flow</code></p> </li> <li> <p>When <code>-86061051</code>:</p> </li> <li><code>material_stuff:int32</code>, <code>bool_parameter:int32</code></li> <li><code>textures</code></li> <li><code>refraction</code></li> <li><code>materials</code></li> <li><code>level_of_detail</code></li> <li> <p><code>empty_string</code></p> </li> <li> <p>When <code>-86061055</code>:</p> </li> <li><code>bool_parameter:int32</code></li> <li><code>textures</code></li> <li><code>refraction</code></li> <li><code>materials</code></li> </ul> <p>Unknown values cause the reader to abort.</p>"},{"location":"drs/cdspmeshfile/#meshdata","title":"MeshData","text":"<p>A single vertex stream.</p> Field Type Description <code>revision</code> <code>int32</code> Stream revision. <code>vertex_size</code> <code>int32</code> Size of each vertex (in bytes). <code>vertices</code> <code>byte[vertex_size \u00d7 vertex_count]</code> Raw vertex data. <p>The vertex layout depends on <code>revision</code>.</p>"},{"location":"drs/cdspmeshfile/#materials","title":"Materials","text":"<p>Contains numeric material parameters such as smoothness, reflectivity, or refraction scale.</p> Field Type Description <code>length</code> <code>int32</code> Number of material entries. <code>materials</code> <code>Material[length]</code> Material list."},{"location":"drs/cdspmeshfile/#material","title":"Material","text":"Field Type Description <code>identifier</code> <code>int32</code> Parameter ID (e.g. smoothness, metalness, etc.). <code>value</code> <code>float</code> Parameter value. <p>Known identifiers: - 1668510769 \u2192 smoothness - 1668510770 \u2192 metalness - 1668510771 \u2192 reflectivity - 1668510772 \u2192 emissivity - 1668510773 \u2192 refraction_scale - 1668510774 \u2192 distortion_mesh_scale - 1935897704 \u2192 scratch - 1668510775 \u2192 specular_scale - 1668510776 \u2192 wind_response - 1668510777 \u2192 wind_height - 1935893623 \u2192 depth_write_threshold - 1668510785 \u2192 saturation</p>"},{"location":"drs/cdspmeshfile/#textures","title":"Textures","text":"<p>List of texture references.</p> Field Type Description <code>length</code> <code>int32</code> Number of textures. <code>textures</code> <code>Texture[length]</code> Texture entries."},{"location":"drs/cdspmeshfile/#texture","title":"Texture","text":"Field Type Description <code>identifier</code> <code>int32</code> Texture slot/type ID. <code>length</code> <code>int32</code> String length. <code>name</code> <code>byte[length]</code> Texture name (UTF-8). <code>spacer</code> <code>int32</code> Stored value after the string."},{"location":"drs/cdspmeshfile/#refraction","title":"Refraction","text":"Field Type Description <code>length</code> <code>int32</code> Entry count. If <code>length == 1</code> One tuple of <code>identifier:int32</code> + 3\u00d7<code>float</code> color. If <code>length &gt; 1</code> Reader loops over all entries, writer only supports one."},{"location":"drs/cdspmeshfile/#levelofdetail","title":"LevelOfDetail","text":"Field Type Description <code>length</code> <code>int32</code> Expected to be 1. <code>lod_level</code> <code>int32</code> LOD level."},{"location":"drs/cdspmeshfile/#emptystring","title":"EmptyString","text":"Field Type Description <code>length</code> <code>int32</code> String length. <code>data</code> <code>byte[length * 2]</code> Raw UTF-8/UTF-16 data."},{"location":"drs/cdspmeshfile/#flow","title":"Flow","text":"<p>Optional vector block (present when <code>material_parameters == -86061050</code>).</p> Field Type Description <code>length</code> <code>int32</code> Number of entries (commonly 4). <code>entries</code> <code>FlowEntry[length]</code> Each entry is <code>identifier:int32</code> + <code>Vector4</code>."},{"location":"drs/cdspmeshfile/#validation-rules","title":"Validation Rules","text":"Rule Why it matters <code>magic == 1314189598</code> Confirms valid block header. <code>mesh_count == len(meshes)</code> Internal consistency. Non-negative vertex/face counts Prevents buffer errors. AABB min &lt; max Ensures valid bounding box. Material/texture arrays use matching lengths Prevents offset mismatches."},{"location":"drs/cdspmeshfile/#cross-references","title":"Cross-References","text":"<ul> <li>Header link: See Header \u2192 NodeInformation for how this block appears in DRS tables.  </li> <li>Common structures: Vector3, Vector4, Face.  </li> <li>Related blocks: CGeoMesh for raw geometry, CollisionShape for collision data.</li> </ul>"},{"location":"drs/cdspmeshfile/#nice-to-know","title":"Nice to know","text":"<ul> <li>The three trailing <code>Vector4</code> points at the end of the file are always written and read back, even if their purpose isn\u2019t fully clear.  </li> <li>The exporter and importer expect matching <code>material_parameters</code> constants; unknown ones will throw an exception.</li> </ul>"},{"location":"drs/cgeomesh/","title":"CGeoMesh","text":"<p>Represents the final triangle mesh after deduplication \u2014 a compact list of faces and vertices used by other systems. This block itself contains only indices and vertices (Vector4). UVs, normals, tangents, materials, LOD, etc. are defined in other classes (e.g. <code>CDspMeshFile</code>/<code>BattleforgeMesh</code>).</p>"},{"location":"drs/cgeomesh/#overview","title":"Overview","text":"<ul> <li>Purpose: Provide a clean, deduplicated triangle list for geometry consumers.</li> <li>Where it shows up: As a node referenced from the DRS header; used by systems that only need raw geometry.</li> <li>Engine impact: Only counts matter here (indices/vertices). Shading/material behavior is elsewhere.</li> </ul>"},{"location":"drs/cgeomesh/#structure","title":"Structure","text":"Field Type Default Description <code>magic</code> <code>uint</code> <code>1</code> Constant identifier inside the block (not the <code>NodeInformation.magic</code>) <code>index_count</code> <code>uint</code> <code>0</code> Number of face indices (<code>#faces * 3</code>) <code>faces</code> <code>List[Face]</code> \u2013 Triangles (see Face, 3 \u00d7 <code>ushort</code> indices) <code>vertex_count</code> <code>uint</code> \u2013 Number of vertices <code>vertices</code> <code>List[Vector4]</code> \u2013 See Vector4 / Vertex4, typically <code>w = 1.0</code> <p>For the node\u2019s class tagging in the container, see Glossary \u2192 MagicValues \u2192 <code>CGeoMesh</code> (this is <code>NodeInformation.magic</code>, not the <code>magic</code> field above).</p>"},{"location":"drs/cgeomesh/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>What this block is / isn\u2019t: <code>CGeoMesh</code> is a raw triangle soup with 16-bit indices and <code>Vector4</code> vertices. It does not carry normals, UVs, colors, tangents, materials, or LOD info.</li> <li>Where materials/UVs live:   Material assignment, textures, extra mesh params, and LOD handling are defined in higher-level mesh containers such as <code>CDspMeshFile</code> / <code>BattleforgeMesh</code>.</li> <li>Blender workflow (practical tips):</li> <li>Ensure the exported mesh is triangulated; non-tris will be converted to triangle faces.</li> <li>Keep vertex order stable to avoid index churn (helps diffs and downstream caches).</li> <li>Apply transforms before export (rotation/scale) so the vertex data is already in the expected object space.</li> </ul>"},{"location":"drs/cgeomesh/#validation-rules","title":"Validation Rules","text":"Rule Why it matters <code>magic == 1</code> Confirms correct block type payload. <code>index_count % 3 == 0</code> Must be triangles only. <code>len(vertices) == vertex_count</code> Internal consistency. <code>max(face indices) &lt; vertex_count</code> All indices must reference existing vertices. <code>vertex_count \u2264 65,535</code> 16-bit index limit from <code>Face</code> definition."},{"location":"drs/cgeomesh/#performance-notes","title":"Performance Notes","text":"<ul> <li>This block is minimal: perf implications are proportional to <code>vertex_count</code> and <code>index_count</code> only.</li> <li>Bounding boxes, material batching, and LOD culling happen in other classes; <code>CGeoMesh</code> doesn\u2019t include them.</li> </ul>"},{"location":"drs/cgeomesh/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: See Header \u2192 NodeInformation for how the node points to this payload.</li> <li>Glossary: MagicValues \u2192 <code>CGeoMesh</code> for the container-level magic ID.</li> <li>Common data: Face, Vector4.</li> <li>Related mesh containers: CDspMeshFile</li> </ul>"},{"location":"drs/cgeomesh/#known-variants-game-differences","title":"Known Variants / Game Differences","text":"<ul> <li>None</li> </ul>"},{"location":"drs/cgeomesh/#nice-to-know","title":"Nice to know","text":"<ul> <li><code>Vector4.w</code> is typically <code>1.0</code> and mainly exists for alignment/homogeneous math; importers often ignore it.</li> </ul>"},{"location":"drs/cgeoobbtree/","title":"CGeoOBBTree (Oriented Bounding Box Tree)","text":"<p>Stores an oriented bounding box hierarchy (flat array of nodes) plus a compact triangle list for fast hit-tests, selection and simple collisions. Nodes are <code>OBBNode</code> structs with transform + child/skip indices and triangle span.</p>"},{"location":"drs/cgeoobbtree/#overview","title":"Overview","text":"<ul> <li>Purpose: Broad/narrow-phase acceleration for mesh intersection and selection.</li> <li>Where it shows up: Most renderable assets that need picking or collisions.</li> <li>Engine impact: Tighter boxes and fewer nodes = fewer tests and faster queries.</li> </ul>"},{"location":"drs/cgeoobbtree/#structure","title":"Structure","text":"Field Type Default Description <code>magic</code> <code>int32</code> 1845540702 Block signature (not NodeInformation.magic). <code>version</code> <code>int32</code> 3 Current layout version. <code>matrix_count</code> <code>int32</code> \u2013 Number of OBB nodes. <code>obb_nodes</code> <code>array</code> \u2013 <code>matrix_count</code> \u00d7 OBBNode. <code>triangle_count</code> <code>int32</code> \u2013 Number of triangles referenced by the tree. <code>faces</code> <code>array</code> \u2013 <code>triangle_count</code> \u00d7 <code>Face</code> (3\u00d7<code>uint16</code> indices). See Face. <p>Nodes are stored contiguously; parent/child relations are via indices into this array. Faces form one global list shared by all leaves. See shared structs in Common.</p>"},{"location":"drs/cgeoobbtree/#obbnode","title":"OBBNode","text":"Field Type Bytes Description <code>oriented_bounding_box</code> <code>CMatCoordinateSystem</code> 48 Rotation basis (<code>Matrix3x3</code>) + position (<code>Vector3</code>). No scale. <code>first_child_index</code> <code>uint16</code> 2 Index into <code>obb_nodes</code>, or <code>0</code> if leaf. <code>second_child_index</code> <code>uint16</code> 2 Index into <code>obb_nodes</code>, or <code>0</code> if leaf. <code>skip_pointer</code> <code>uint16</code> 2 Index used to skip an entire subtree (stackless traversal). <code>node_depth</code> <code>uint16</code> 2 Depth (root = 0). <code>triangle_offset</code> <code>uint32</code> 4 Start into the global face list for this node\u2019s span. <code>total_triangles</code> <code>uint32</code> 4 Number of triangles covered by this node. <p>Leaf vs. Internal - Leaf: both child indices are <code>0</code>; triangles are defined by <code>triangle_offset</code> + <code>total_triangles</code>. - Internal: child indices point to two nodes; triangle span may be <code>0</code> for non-leaves.</p>"},{"location":"drs/cgeoobbtree/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>What artists control: The shape ultimately follows your exported mesh. Cleaner topology \u2192 tighter OBBs \u2192 fewer false hits.</li> <li>Transforms: Nodes store rotation + position only; no scale. Keep rotations valid (orthonormal-ish) to avoid degenerate boxes. See CMatCoordinateSystem.</li> <li>Exporter note: The plugin uses a newer OBB fitting that can produce smaller boxes than legacy data \u2014 that\u2019s expected and good. </li> <li>Triangles: The tree references the same face list (3\u00d7<code>uint16</code> indices). Respect 16-bit limits from Face.</li> </ul>"},{"location":"drs/cgeoobbtree/#validation-rules","title":"Validation Rules","text":"Rule Why it matters <code>magic == 1845540702</code>, <code>version == 3</code> Confirms block layout. <code>matrix_count == len(obb_nodes)</code> Node array integrity. Child/skip indices <code>&lt; matrix_count</code> (or <code>0</code> for leaf) Prevents OOB traversal. <code>triangle_offset + total_triangles \u2264 triangle_count</code> Valid leaf spans. Face indices <code>&lt; vertex_count</code> (from the linked mesh) Keeps references valid (16-bit). OBB basis ~orthonormal Invalid bases break collision math."},{"location":"drs/cgeoobbtree/#performance-notes","title":"Performance Notes","text":"<ul> <li>Tighter OBBs and balanced splits reduce tests.</li> <li>Skip pointer enables stackless traversal; big win in broad-phase pruning.</li> <li>Triangle list is shared \u2192 good cache behavior when testing neighboring leaves.</li> </ul>"},{"location":"drs/cgeoobbtree/#cross-references","title":"Cross-References","text":"<ul> <li>Header link: How the node points here \u2192 Header \u2192 NodeInformation.</li> <li>Glossary: MagicValues \u2192 <code>CGeoOBBTree</code> for the container-level magic ID.</li> <li>Common data: CMatCoordinateSystem, Vector3, Matrix3x3, Face.</li> <li>Related geometry: The faces come from your visual mesh; see CGeoMesh.</li> </ul>"},{"location":"drs/cgeoobbtree/#known-variants-game-differences","title":"Known Variants / Game Differences","text":"<ul> <li>Legacy data may have looser OBBs from older fitting routines; the block layout itself remains the same.</li> </ul>"},{"location":"drs/cgeoobbtree/#nice-to-know","title":"Nice to know","text":"<ul> <li>Nodes are laid out to favor sequential reads (CPU cache friendly). Leaves often cluster triangles from nearby space.</li> </ul>"},{"location":"drs/cgeoprimitivecontainer/","title":"CGeoPrimitiveContainer","text":"<p>Marker node used by certain object types. It has no payload; it exists to structure the DRS and gate where primitive or collision-related blocks appear in the node order.</p>"},{"location":"drs/cgeoprimitivecontainer/#overview","title":"Overview","text":"<ul> <li>Purpose: Structural placeholder in the DRS hierarchy (no data to edit).  </li> <li>Where it shows up: Common in static objects and some animated objects with collision, placed before OBB/collision mesh blocks in the write order.  </li> <li>Engine impact: None directly; readers use its presence to route parsing/ordering.</li> </ul>"},{"location":"drs/cgeoprimitivecontainer/#structure","title":"Structure","text":"Field Type Default Description (none) \u2013 \u2013 This class has no binary content (size <code>0</code>)."},{"location":"drs/cgeoprimitivecontainer/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>Nothing to tweak: Artists don\u2019t edit this node; it\u2019s created or written by the exporter to keep node order consistent.  </li> <li>Why you might care: If you diff DRS files or inspect node tables, you\u2019ll see this entry around collision-related blocks. Its presence doesn\u2019t change visuals or physics on its own.</li> </ul>"},{"location":"drs/cgeoprimitivecontainer/#validation-rules","title":"Validation Rules","text":"Rule Why it matters <code>size == 0</code> Confirms it\u2019s truly a marker-only block. NodeInformation points to a 0-byte region Keeps offsets and sizes consistent for readers."},{"location":"drs/cgeoprimitivecontainer/#performance-notes","title":"Performance Notes","text":"<p>None \u2014 zero-size marker; no runtime data or traversal costs.</p>"},{"location":"drs/cgeoprimitivecontainer/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: How classes are linked \u2192 Header \u2192 NodeInformation.  </li> <li>Write order contexts: Appears in StaticObjectCollision and AnimatedObjectCollision pipelines before OBBTree or Mesh.  </li> <li>Magic value: <code>CGeoPrimitiveContainer = 1396683476 (0x5342C5D4)</code>. See Glossary \u2192 MagicValues.</li> </ul>"},{"location":"drs/cgeoprimitivecontainer/#known-variants-game-differences","title":"Known Variants / Game Differences","text":"<p>None known \u2014 always zero-sized in current BF/Skylords data.</p>"},{"location":"drs/cgeoprimitivecontainer/#nice-to-know","title":"Nice to know","text":"<p>If you delete it manually from a DRS, some tools may still load fine, but exporters and validators expect it where defined by the node order. Keep it.</p>"},{"location":"drs/collisionshape/","title":"collisionShape","text":"<p>Holds a set of simple collision volumes (boxes, spheres, cylinders) used by static objects and some animated objects (non-unit) for hit checks, selection and placement. Not used by units (<code>AnimatedUnit</code>); those rely on other mechanisms.</p>"},{"location":"drs/collisionshape/#overview","title":"Overview","text":"<ul> <li>Purpose: Fast, approximate collisions without per-triangle tests.</li> <li>Where it shows up: Present in StaticObjectCollision and AnimatedObjectCollision models; absent in AnimatedUnit.</li> <li>Engine impact: Cheap broad-phase tests. Triangle trees (e.g. <code>CGeoOBBTree</code>) may be consulted only if needed.</li> </ul>"},{"location":"drs/collisionshape/#structure","title":"Structure","text":"<p>A compact header plus three counted arrays. There is no \u201cCollisionPrimitive\u201d union; shapes are stored by concrete type.</p> Field Type Default Description <code>version</code> <code>byte</code> <code>1</code> Format version. <code>box_count</code> <code>uint</code> \u2013 Number of boxes. <code>boxes</code> <code>BoxShape[box_count]</code> \u2013 See BoxShape. <code>sphere_count</code> <code>uint</code> \u2013 Number of spheres. <code>spheres</code> <code>SphereShape[sphere_count]</code> \u2013 See SphereShape. <code>cylinder_count</code> <code>uint</code> \u2013 Number of cylinders. <code>cylinders</code> <code>CylinderShape[cylinder_count]</code> \u2013 See CylinderShape."},{"location":"drs/collisionshape/#boxshape","title":"BoxShape","text":"<p>Rectangular volume with local transform + AABB extents.</p> Field Type Description <code>coord_system</code> CMatCoordinateSystem Local orientation and position (no scale). <code>geo_aabox</code> CGeoAABox Lower/upper corners in local space."},{"location":"drs/collisionshape/#cgeoaabox","title":"CGeoAABox","text":"Field Type Description <code>lower_left_corner</code> Vector3 One corner of the box. <code>upper_right_corner</code> Vector3 Opposite corner of the box."},{"location":"drs/collisionshape/#sphereshape","title":"SphereShape","text":"Field Type Description <code>coord_system</code> CMatCoordinateSystem Position (orientation irrelevant). <code>geo_sphere</code> CGeoSphere Radius + center."},{"location":"drs/collisionshape/#cgeosphere","title":"CGeoSphere","text":"Field Type Description <code>radius</code> <code>float</code> Sphere radius. <code>center</code> Vector3 Center in local space (often 0,0,0)."},{"location":"drs/collisionshape/#cylindershape","title":"CylinderShape","text":"Field Type Description <code>coord_system</code> CMatCoordinateSystem Local orientation and position. <code>geo_cylinder</code> CGeoCylinder Center, height, radius."},{"location":"drs/collisionshape/#cgeocylinder","title":"CGeoCylinder","text":"Field Type Description <code>center</code> Vector3 Cylinder center in local space. <code>height</code> <code>float</code> Height along the local up-axis. <code>radius</code> <code>float</code> Base radius."},{"location":"drs/collisionshape/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>Blender workflow: Create dedicated collision objects (box/sphere/cylinder) and tag them; the exporter writes them into the respective arrays.</li> <li>Transforms: Apply scale/rotation before export. <code>CMatCoordinateSystem</code> stores rotation + position (no non-uniform scale), while dimensions live in the geo structs.</li> <li>Usage pattern: These primitives provide quick acceptance/rejection. If a model also has <code>CGeoOBBTree</code>, detailed triangle tests can follow.</li> </ul>"},{"location":"drs/collisionshape/#validation-rules","title":"Validation Rules","text":"Rule Why <code>version == 1</code> Confirms layout. Counts match array lengths Prevents read overruns. Positive dimensions (radius/height/extents) Zero/negative sizes break tests. Orthonormal rotation in <code>coord_system</code> Keeps boxes/cylinders well-formed."},{"location":"drs/collisionshape/#performance-notes","title":"Performance Notes","text":"<ul> <li>Spheres are the cheapest test, boxes next, cylinders slightly heavier.</li> <li>Keep the number of shapes minimal; a few well-placed volumes beat many tiny ones.</li> </ul>"},{"location":"drs/collisionshape/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: See Header \u2192 NodeInformation for how this block is linked.</li> <li>Glossary: MagicValues \u2192 <code>collisionShape</code> for the container-level magic ID.</li> <li>Geometry: Often paired with CGeoOBBTree and CGeoMesh.</li> <li>Common structs: CMatCoordinateSystem, Vector3.</li> </ul>"},{"location":"drs/collisionshape/#known-variants-game-differences","title":"Known Variants / Game Differences","text":"<ul> <li>Current data uses the three concrete shape arrays shown above. No union/variant record is present.</li> </ul>"},{"location":"drs/collisionshape/#nice-to-know","title":"Nice to know","text":"<p>The node name is stored as <code>collisionShape</code> (lowercase c) in the hierarchy.</p>"},{"location":"drs/common/","title":"Common Structures","text":"<p>Canonical definitions for small, frequently reused data structures across DRS classes. These structs are referenced by multiple classes such as <code>CGeoMesh</code>, <code>CGeoSubset</code>, and <code>CGeoMaterial</code>.</p>"},{"location":"drs/common/#face","title":"Face","text":"<p>A <code>Face</code> represents a triangle defined by three 16-bit vertex indices into a mesh\u2019s <code>vertices</code> array.</p> Field Type Description <code>i0</code> <code>ushort</code> Index of first vertex (0-based) <code>i1</code> <code>ushort</code> Index of second vertex (0-based) <code>i2</code> <code>ushort</code> Index of third vertex (0-based) <p>Notes - Each face always references exactly three vertices \u2014 only triangles are supported. - Because face indices are stored as <code>ushort</code>, both the vertex index and face count are constrained by 16-bit limits.</p>"},{"location":"drs/common/#limits","title":"Limits","text":"Constraint Description <code>vertex_count \u2264 65,535</code> Maximum addressable vertex index (<code>ushort</code> limit) <code>face_count \u2264 21,845</code> Maximum number of triangles (<code>65,535 / 3 \u2248 21,845</code>) if fully packed <code>index_count = face_count * 3</code> Each face consumes three indices <p>Implications - A single mesh block can contain at most ~21 k triangles. - Larger objects must be split into multiple mesh chunks.</p>"},{"location":"drs/common/#vertex-vector4","title":"Vertex (Vector4)","text":"<p>A <code>Vertex</code> used by many classes is a 4D float vector where <code>w</code> is always <code>1.0</code>.</p> Component Type Description <code>x</code> <code>float</code> X coordinate <code>y</code> <code>float</code> Y coordinate <code>z</code> <code>float</code> Z coordinate <code>w</code> <code>float</code> Always <code>1.0</code> (homogeneous coordinate) <p>Notes - The extra component <code>w</code> exists for alignment and homogeneous transform support. - Importers typically ignore <code>w</code> since it\u2019s constant.</p>"},{"location":"drs/common/#vector3","title":"Vector3","text":"<p>A 3D point or direction, stored as three 32-bit floats (<code>x</code>, <code>y</code>, <code>z</code>). Total size: 12 bytes. </p> Component Type Bytes Notes <code>x</code> float 4 little-endian IEEE-754 <code>y</code> float 4 <code>z</code> float 4 <p>Usage Common across geometry and animation data (e.g., <code>CGeoAABox</code>, marker positions/directions, etc.). </p> <p>Constraints / Conventions - Exactly 3 floats; no padding or <code>w</code> component. - Coordinate meaning depends on the parent structure (position vs. direction). </p>"},{"location":"drs/common/#matrix3x3","title":"Matrix3x3","text":"<p>A 3\u00d73 orientation (rotation) matrix stored as 9 floats in row-major order. Total size: 36 bytes. </p> Row Elements Type Bytes 0 <code>m00 m01 m02</code> float 12 1 <code>m10 m11 m12</code> float 12 2 <code>m20 m21 m22</code> float 12 <p>Usage Represents orientation in <code>CMatCoordinateSystem</code> and other transforms. Stored/serialized as 9 consecutive floats. </p> <p>Constraints / Conventions - Intended to be a rotation basis; normalization/orthogonality is expected by readers. - Serialization is strictly 9 floats; no implicit translation. </p>"},{"location":"drs/common/#matrix4x4","title":"Matrix4x4","text":"<p>A full 4\u00d74 transform matrix stored as 16 floats in row-major order. Total size: 64 bytes. </p> Row Elements Type Bytes 0 <code>m00 m01 m02 m03</code> float 16 1 <code>m10 m11 m12 m13</code> float 16 2 <code>m20 m21 m22 m23</code> float 16 3 <code>m30 m31 m32 m33</code> float 16 <p>Usage Used where a complete affine transform is required (e.g., skeleton super-parent). Written row by row. </p> <p>Constraints / Conventions - 16 floats, no extra padding. - Meaning of the last column/row follows typical affine layout; specific interpretation depends on the consuming block. </p>"},{"location":"drs/common/#cmatcoordinatesystem","title":"CMatCoordinateSystem","text":"<p>Compact transform pairing orientation (<code>Matrix3x3</code>) with position (<code>Vector3</code>). Total size: 48 bytes (<code>36 + 12</code>). </p> Field Type Bytes Description <code>matrix</code> <code>Matrix3x3</code> 36 Rotation basis (row-major) <code>position</code> <code>Vector3</code> 12 Translation (x, y, z) <p>Usage - Core transform used by many blocks: <code>SLocator</code>, <code>OBBNode</code>, <code>BoxShape</code>, <code>CylinderShape</code>, <code>SphereShape</code>, etc. - Always serialized as 9 floats (matrix) followed by 3 floats (position). </p> <p>Constraints / Conventions - No scale component; scale is not supported. - Consumers assume the matrix encodes a valid rotation basis. </p>"},{"location":"drs/cskskeleton/","title":"CSkSkeleton","text":"<p>Stores the bone hierarchy (skeleton) used for animating skinned meshes. It defines the names, parent-child relationships, and bind-pose transformations for all bones. \ud83e\uddb4</p>"},{"location":"drs/cskskeleton/#overview","title":"Overview","text":"<ul> <li>Purpose: Defines the articulated structure (bones) that drives the deformation of animated characters and objects.</li> <li>Where it appears: Included in animated model types: <code>AnimatedUnit</code>, <code>AnimatedObjectNoCollision</code>, <code>AnimatedObjectCollision</code>. It's absent in static models. Appears after <code>CSkSkinInfo</code> in the <code>WriteOrder</code>.</li> <li>Engine impact: Forms the basis for skeletal animation playback. The number of bones and hierarchy depth can affect animation performance.</li> </ul>"},{"location":"drs/cskskeleton/#structure","title":"Structure","text":"Field Type Description <code>magic</code> <code>int32</code> Internal block identifier, should be <code>1558308612</code>. <code>version</code> <code>int32</code> Format version, typically <code>3</code>. <code>bone_matrix_count</code> <code>int32</code> Number of entries in <code>bone_matrices</code>. Should match <code>bone_count</code>. <code>bone_matrices</code> <code>List[BoneMatrix]</code> Bind pose transformation data for each bone, ordered sequentially by bone <code>identifier</code> (0, 1, 2...). See BoneMatrix. <code>bone_count</code> <code>int32</code> Total number of bones in the skeleton. <code>bones</code> <code>List[Bone]</code> The list defining each bone's properties and hierarchy. Note: This list is ordered by <code>Bone.version</code>, not necessarily by bone <code>identifier</code>. See Bone. <code>super_parent</code> <code>Matrix4x4</code> Root transformation matrix, usually identity. See Matrix4x4."},{"location":"drs/cskskeleton/#bonematrix","title":"BoneMatrix","text":"<p>Contains bind pose data derived from four <code>BoneVertex</code> entries, effectively storing the bone's local transform relative to its parent (or world space for root bones).</p> Field Type Description <code>bone_vertices</code> <code>List[BoneVertex]</code> Four vertices defining the bone's orientation, position, and hierarchical links. Always 4 entries. See BoneVertex."},{"location":"drs/cskskeleton/#bonevertex","title":"BoneVertex","text":"<p>A helper structure within <code>BoneMatrix</code>. The <code>parent</code> field is key for linking within the skeleton's structure, particularly for the first two vertices.</p> Field Type Description <code>position</code> <code>Vector3</code> A 3D coordinate related to the bone's bind pose. See Vector3. <code>parent</code> <code>int32</code> Index linking to bone identifiers, with specific meaning based on its index within <code>bone_vertices</code>: <p>Specific <code>parent</code> field usage within <code>BoneMatrix.bone_vertices</code>:</p> <ul> <li><code>bone_vertices[0].parent</code>: Stores the <code>identifier</code> of this bone's parent bone in the hierarchy. For the root bone (identifier 0), this value is <code>-1</code>. This directly links a bone back to its parent.</li> <li><code>bone_vertices[1].parent</code>: Stores the <code>identifier</code> of the bone itself. This acts as a self-reference.</li> <li><code>bone_vertices[2].parent</code>: Hardcoded to <code>0</code> during export (<code>create_skeleton</code>). Its specific use in-game is unclear.</li> <li><code>bone_vertices[3].parent</code>: Hardcoded to <code>0</code> during export (<code>create_skeleton</code>). Its specific use in-game is unclear.</li> </ul>"},{"location":"drs/cskskeleton/#bone","title":"Bone","text":"<p>Defines a single bone in the skeleton hierarchy. Remember this list is ordered by <code>version</code>, not <code>identifier</code>.</p> Field Type Description <code>version</code> <code>uint32</code> Bone version/identifier, often derived from a hash or predefined list (<code>bone_versions.json</code>). Used for sorting this list. <code>identifier</code> <code>int32</code> Unique ID for this bone within the skeleton (0 for root, 1, 2...). Used by <code>CSkSkinInfo</code> and <code>CDspJointMap</code>. Used for indexing <code>bone_matrices</code>. <code>name_length</code> <code>int32</code> Length of the bone name string. <code>name</code> <code>string</code> Name of the bone (e.g., \"Bip01_Head\"). Limited to 63 characters by importer/exporter (hashes longer names). <code>child_count</code> <code>int32</code> Number of direct children this bone has. <code>children</code> <code>List[int32]</code> List of <code>identifier</code> values for the children bones."},{"location":"drs/cskskeleton/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>Blender Workflow:<ul> <li>Creation: Created automatically during export (<code>create_skeleton</code> in <code>drs_utility.py</code>) from a Blender Armature object within the model's collection.</li> <li>Hierarchy: The parent-child relationships in the Blender Armature directly define the <code>Bone.children</code> and the <code>BoneVertex[0].parent</code> links in the exported <code>CSkSkeleton</code>. The root bone in Blender (usually the one with no parent) becomes bone <code>identifier</code> 0.</li> <li>Bone Map: The exporter generates a <code>bone_map</code> (<code>create_bone_map</code>) which assigns a unique sequential <code>identifier</code> (0, 1, 2...) to each bone based on traversing the hierarchy. This map is crucial for linking skin weights (<code>CSkSkinInfo</code>) and joint maps (<code>CDspJointMap</code>), and determines the order of the <code>bone_matrices</code> array.</li> <li>Bone Ordering: The <code>bones</code> list itself is sorted based on the <code>Bone.version</code> field (potentially from <code>bone_versions.json</code> or a hash) before writing. The <code>bone_matrices</code> list remains ordered by the hierarchical <code>identifier</code>.</li> <li>Naming: Bone names are taken directly from the Blender Armature. The importer/exporter enforces a 63-character limit; longer names might be hashed (<code>Bone.read</code> logic). Standard naming conventions (like \"Bip01_...\") are recommended.</li> <li>Bind Pose: The <code>bone_matrices</code> are calculated from the bone's Rest Pose transforms in Blender (<code>armature_bone.matrix_local</code>).</li> </ul> </li> <li>Import: When importing (<code>import_csk_skeleton</code>, <code>init_bones</code>), the <code>CSkSkeleton</code> data is used to reconstruct the Armature object in Blender, including bone names, hierarchy (<code>create_bone_tree</code> uses parent links), and setting the Rest Pose (<code>record_bind_pose</code>).</li> </ul>"},{"location":"drs/cskskeleton/#validation-rules","title":"Validation Rules","text":"Rule Why <code>magic == 1558308612</code> Confirms block type. <code>version == 3</code> Ensures expected format. <code>bone_matrix_count == bone_count</code> Each bone needs matrix data. <code>bone_count == len(bones)</code> Bone array must match its count. Bone <code>identifier</code> values are unique and sequential (0 to <code>bone_count</code>-1) Required for consistent indexing by other systems. Child indices in <code>Bone.children</code> are valid bone <code>identifier</code> values Prevents broken hierarchy links. <code>BoneVertex[0].parent</code> index is valid (<code>-1</code> or 0 to <code>bone_count</code>-1) Ensures correct parent linking. <code>BoneVertex[1].parent == Bone.identifier</code> Consistency check for self-reference. Bone names are unique and &lt;= 63 chars Ensures correct mapping and avoids engine/tool limitations."},{"location":"drs/cskskeleton/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: Referenced via <code>NodeInformation</code> in the DRS header. See Header.</li> <li>Skinning Weights: Provides the bone <code>identifier</code> values referenced by <code>CSkSkinInfo</code>. See CSkSkinInfo.</li> <li>Joint Map: Provides the bone <code>identifier</code> values referenced by <code>CDspJointMap</code>. See CDspJointMap.</li> <li>Common Structures: Uses <code>Matrix4x4</code> and <code>Vector3</code>. See Common Structures.</li> </ul>"},{"location":"drs/cskskeleton/#nice-to-know","title":"Nice to know","text":"<ul> <li>Magic Value: <code>CSkSkeleton = -2110567991</code> (0x823299C9). See Glossary \u2192 MagicValues.</li> <li>Node Name: The node is typically named <code>csk_skeleton</code> in the hierarchy during export.</li> <li>Ordering Difference: Be aware that the <code>bones</code> list is sorted by <code>version</code>, while <code>bone_matrices</code> are indexed by the sequential <code>identifier</code>. This means <code>bones[i].identifier</code> does not necessarily equal <code>i</code>.</li> </ul>"},{"location":"drs/cskskininfo/","title":"CSkSkinInfo","text":""},{"location":"drs/cskskininfo/#overview","title":"Overview","text":"<p><code>CSkSkinInfo</code> defines how each vertex in a mesh is influenced by bones from the skeleton. It determines how meshes deform when animated. Each vertex stores a small list of bones and their respective weights. This block appears in animated DRS assets and is generated automatically when the model has an armature with vertex groups.</p> <p>In the <code>WriteOrder</code> defined in <code>drs_definitions.py</code>, it appears for: - <code>AnimatedUnit</code> - <code>AnimatedObjectCollision</code> - <code>AnimatedObjectNoCollision</code></p> <p>It is not used for static objects without a skeleton.</p>"},{"location":"drs/cskskininfo/#structure","title":"Structure","text":"Field Type Description <code>version</code> <code>int32</code> Internal version number for the format. <code>vertex_count</code> <code>int32</code> Number of vertices with weight data. <code>vertex_data</code> <code>List[VertexData]</code> One entry per vertex, containing bone indices and weights."},{"location":"drs/cskskininfo/#vertexdata","title":"VertexData","text":"Field Type Description <code>bone_indices</code> <code>List[int]</code> Bone IDs influencing this vertex. The IDs reference the bones from <code>CSkSkeleton</code>. <code>weights</code> <code>List[float]</code> Normalized influence weights for each bone index (usually up to 4 per vertex)."},{"location":"drs/cskskininfo/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<p>When exporting from Blender, the <code>create_skin_info()</code> function in <code>drs_utility.py</code> gathers the skin data like this:</p> <ol> <li> <p>Vertex Source:    A unified list of all mesh vertices is created (from the exported mesh). Vertices are matched by position using rounding and KD-tree lookup to ensure each Blender vertex connects to the correct exported vertex.</p> </li> <li> <p>Bone Mapping:    Blender\u2019s vertex groups are matched to bones in the armature.    The mapping uses the bone names from <code>CSkSkeleton</code> to find the correct bone ID.    Each vertex group name must exactly match its bone name to export correctly.</p> </li> <li> <p>Weight Handling:    Each vertex can store up to 4 influences. If more are found, only the 4 highest weights are kept.    Weights are then normalized to ensure their total equals 1.0.</p> </li> <li> <p>Import Behavior:    When importing, the tool recreates vertex groups in Blender based on stored bone indices and weights, matching the bones from the linked skeleton.    Missing bones or mismatched names are skipped but logged for visibility.</p> </li> </ol> <p>In-game, this data ensures that mesh vertices follow the correct bones as they animate. Missing or invalid weights can cause visible stretching or collapsing of the model.</p>"},{"location":"drs/cskskininfo/#validation-rules","title":"Validation Rules","text":"Rule Why it matters Each vertex has \u2264 4 influences Game engine expects a fixed small number for performance. Weights per vertex sum to 1.0 Prevents visual deformation errors. Each bone index exists in <code>CSkSkeleton</code> Ensures valid bone links for animation. Vertex match succeeds during export Prevents missing weight assignments."},{"location":"drs/cskskininfo/#cross-references","title":"Cross-References","text":"<ul> <li>Skeleton: <code>CSkSkeleton</code> \u2014 provides the bone hierarchy and IDs used here.  </li> <li>Mesh: <code>CDspMeshFile</code> \u2014 contains the vertices that the weights are applied to.  </li> <li>Joint Mapping: <code>CDspJointMap</code> \u2014 connects mesh joints to the correct bones.  </li> <li>Write Order: Listed for animated objects in <code>drs_definitions.py</code>.</li> </ul>"},{"location":"drs/cskskininfo/#nice-to-know","title":"Nice to know","text":"<ul> <li>This block is written only when a mesh has vertex groups and a valid armature.  </li> <li>If bone names don\u2019t match exactly between Blender and the skeleton, those weights are skipped and logged.  </li> <li>Removing unused vertex groups before export helps reduce unnecessary data and warnings.</li> </ul>"},{"location":"drs/drwresourcemeta/","title":"DrwResourceMeta","text":"<p>Contains metadata about the DRS resource, specifically a version number and a hash string.</p>"},{"location":"drs/drwresourcemeta/#overview","title":"Overview","text":"<ul> <li>Purpose: Stores basic metadata, primarily a hash likely used for asset identification or version tracking.</li> <li>Where it appears: Present in all defined model types (<code>AnimatedUnit</code>, <code>StaticObjectCollision</code>, <code>StaticObjectNoCollision</code>, <code>AnimatedObjectNoCollision</code>, <code>AnimatedObjectCollision</code>). See <code>WriteOrder</code>.</li> <li>Engine impact: Likely used by the engine or tools for identifying or verifying the asset version. It doesn't directly affect rendering or gameplay mechanics visible to artists.</li> </ul>"},{"location":"drs/drwresourcemeta/#structure","title":"Structure","text":"Field Type Description <code>version</code> <code>int32</code> Format version number, typically <code>1</code>. <code>unknown</code> <code>int32</code> An unknown integer value. Observed values include <code>0</code>, <code>1</code>, <code>2</code>, <code>3</code>. Default appears to be <code>1</code> for units. <code>length</code> <code>int32</code> Length of the following <code>hash</code> string in bytes. <code>hash</code> <code>string</code> A string containing hash information (e.g., \"sr-1234567890-0\")."},{"location":"drs/drwresourcemeta/#authoring-in-game-behavior","title":"Authoring &amp; In-Game Behavior","text":"<ul> <li>Blender Workflow: This block is generated automatically by the exporter (<code>save_drs</code> calls <code>DrwResourceMeta().write</code>). Artists do not directly edit this data in Blender.</li> <li>Hash Generation: The exporter currently generates a default hash string (\"\"). The specific logic for generating meaningful hashes (like \"sr-crc32-0\") might reside elsewhere or in older toolchains. The importer (<code>DrwResourceMeta().read</code>) simply reads the existing hash from the file.</li> <li><code>unknown</code> field: The purpose of this field is unclear.</li> </ul>"},{"location":"drs/drwresourcemeta/#validation-rules","title":"Validation Rules","text":"Rule Why <code>version == 1</code> Confirms expected format. <code>length</code> matches actual <code>hash</code> string length Prevents reading incorrect data or buffer overflows."},{"location":"drs/drwresourcemeta/#cross-references","title":"Cross-References","text":"<ul> <li>Header / Nodes: Referenced via <code>NodeInformation</code> in the DRS header. See Header.</li> <li>Glossary: Contains the magic value. See Glossary \u2192 MagicValues.</li> </ul>"},{"location":"drs/drwresourcemeta/#nice-to-know","title":"Nice to know","text":"<ul> <li>Magic Value: <code>DrwResourceMeta = -183033339</code> (0xF518F885).</li> <li>Although present in all models, the actual meaning or usage of the hash string by the game engine isn't known. It likely serves as a unique identifier or checksum.</li> </ul>"},{"location":"drs/header/","title":"DRS Header &amp; Core Nodes","text":"<p>This section describes the DRS file header and the core node structures on which all class data depends. These structures form the backbone of the DRS archive layout.</p>"},{"location":"drs/header/#overview","title":"Overview","text":"Text Only<pre><code>flowchart TD\n  A[DRS Header] --&gt; B[NodeInformation[]]\n  A --&gt; C[Node[]]\n  B --&gt;|info_index| C\n  C --&gt;|name / identifier| D[Class Data Blocks]\n</code></pre> <p>Root Elements</p> <ul> <li>The first NodeInformation entry and the first Node always represent the Root Node.  </li> <li>The Root Node itself does not contain payload data \u2014 it only anchors the hierarchy.</li> </ul>"},{"location":"drs/header/#header-structure","title":"Header Structure","text":"Field Type Description <code>magic</code> <code>int</code> Constant signature value <code>-981667554</code> <code>number_of_models</code> <code>uint</code> Always <code>1</code> in BattleForge <code>node_information_offset</code> <code>uint</code> Offset where the NodeInformation section starts <code>node_hierarchy_offset</code> <code>uint</code> Offset where the Node section starts <code>node_count</code> <code>uint</code> Total number of Nodes <p>The first NodeInformation and Node entries at these offsets correspond to the Root Node.</p>"},{"location":"drs/header/#rootnodeinformation","title":"RootNodeInformation","text":"<p>Represents metadata for the Root Node and tracks how many additional nodes exist.</p> Field Type Default Description <code>zeroes[16]</code> <code>int[16]</code> <code>0</code> Spacer / padding (16\u00d70) <code>neg_one</code> <code>int</code> <code>-1</code> Unknown use, always <code>-1</code> <code>one</code> <code>uint</code> <code>1</code> Unknown use, always <code>1</code> <code>node_information_count</code> <code>uint</code> \u2013 Number of additional NodeInformation entries <code>zero</code> <code>uint</code> <code>0</code> Unknown use, always <code>0</code> <p>Tip</p> <p><code>node_information_count</code> equals <code>node_count - 1</code>, because the Root Node itself is excluded.</p>"},{"location":"drs/header/#nodeinformation","title":"NodeInformation","text":"<p>Links each Node to the data blob of its class.</p> Field Type Description <code>magic</code> <code>int</code> Unique magic number identifying the class type <code>identifier</code> <code>uint</code> References <code>Node.info_index</code> (<code>-1</code> for Root) <code>offset</code> <code>uint</code> File offset where the class data starts <code>size</code> <code>uint</code> Size of the data blob in bytes <code>unused[4]</code> <code>uint[4]</code> Four unused values (ignored in BattleForge / Skylords, used in SpellForce 2)"},{"location":"drs/header/#root-node-first-entry-in-node-hierarchy","title":"Root Node (first entry in Node hierarchy)","text":"Field Type Default Description <code>identifier</code> <code>uint</code> <code>0</code> Identifier of the Root Node <code>unknown</code> <code>uint</code> <code>0</code> Unknown, always zero <code>length</code> <code>uint</code> <code>9</code> Length of the string <code>\"root_node\"</code> <code>name</code> <code>str</code> <code>\"root_node\"</code> Name of the Root Node <p>The Root Node always has identifier <code>0</code> and name <code>\"root_node\"</code>. It precedes all other class nodes in the hierarchy.</p>"},{"location":"drs/header/#node-generic-hierarchy-entry","title":"Node (generic hierarchy entry)","text":"<p>Each Node represents a link between a class name and its corresponding NodeInformation entry. Every Node ends with a zero integer used as a spacer.</p> Field Type Description <code>info_index</code> <code>uint</code> Index into the NodeInformation table (<code>-1</code> for Root) <code>length</code> <code>uint</code> Length of the class name string <code>name</code> <code>str</code> The class name <code>zero</code> <code>uint</code> Always <code>0</code> (spacer)"},{"location":"drs/header/#validation-rules","title":"Validation Rules","text":"Rule Description <code>Header.magic == -981667554</code> Validates file signature <code>Header.node_count &gt;= 1</code> At least one node (Root) must exist <code>RootNode.identifier == 0</code> and <code>RootNode.name == \"root_node\"</code> Root node consistency <code>len(NodeInformation) == Header.node_count - 1</code> Node counts must match (<code>-1</code> for RootNodeInformation) Each <code>Node.info_index &gt;= 0</code> Must reference valid NodeInformation (except Root) No overlapping <code>offset</code>/<code>size</code> pairs Class data blocks must not overlap"},{"location":"drs/header/#known-variants","title":"Known Variants","text":"Game / Version Notes BattleForge / Skylords Reborn <code>unused[4]</code> fields are unused; <code>number_of_models</code> is always <code>1</code>. SpellForce 2 DRS <code>unused[4]</code> were used to override settings for certain assets."},{"location":"drs/header/#summary","title":"Summary","text":"<p>The DRS Header defines where all structural blocks of the archive begin. From there, each NodeInformation and Node entry establishes the relationship between class metadata and data payloads. Understanding this hierarchy is essential before parsing any of the 15 class structures that follow.</p>"}]}