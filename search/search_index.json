{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Overview","text":"<p>Start of something big</p>"},{"location":"glossary/","title":"Glossary (Enums &amp; Constants)","text":"<p>Central reference for magic values, enums and indices used across the DRS format and Blender tools. Values are shown in decimal and hex.</p>"},{"location":"glossary/#magicvalues","title":"MagicValues","text":"<p>These are the <code>NodeInformation.magic</code> identifiers used to tag blocks in the container.</p> Name Decimal Hex <code>CDspJointMap</code> -1340635850 0xB01E64C6 <code>CGeoMesh</code> 100449016 0x05FBDF08 <code>CGeoOBBTree</code> -933519637 0xC88A90FB <code>CSkSkinInfo</code> -761174227 0xD2541ADD <code>CDspMeshFile</code> -1900395636 0x8EDCF4A4 <code>DrwResourceMeta</code> -183033339 0xF51F0ED5 <code>collisionShape</code> 268607026 0x1006C5F2 <code>CGeoPrimitiveContainer</code> 1396683476 0x5342C5D4 <code>CSkSkeleton</code> -2110567991 0x8192C3B9 <code>CDrwLocatorList</code> 735146985 0x2BC5D0C9 <code>AnimationSet</code> -475734043 0xE3A5C3E5 <code>AnimationTimings</code> -1403092629 0xAC56E6BB <code>EffectSet</code> 688490554 0x2912AE1A <p>Note: exact hex is shown as two\u2019s complement for negatives. The decimal values are what you actually read/write.</p>"},{"location":"glossary/#animationtype","title":"AnimationType","text":"<p>Used in <code>AnimationTimings</code> / ability timing metadata.</p> Name Value <code>CastResolve</code> 0 <code>Spawn</code> 1 <code>Melee</code> 2 <code>Channel</code> 3 <code>ModeSwitch</code> 4 <code>WormMovement</code> 5"},{"location":"glossary/#locatorclass","title":"LocatorClass","text":"<p>Semantic meaning for locators in <code>CDrwLocatorList</code>.</p> ID Name Notes 0 <code>HealthBar</code> Health bar offset 1 <code>DestructiblePart</code> Static module/parts 2 <code>Construction</code> \u201cPivotOffset\u201d; construction pieces 3 <code>Turret</code> Animated child unit (plays SKA) 4 <code>FxbIdle</code> WormDecal; idle effects 5 <code>Wheel</code> Animated child (idle/walk/run) 6 <code>StaticPerm</code> FXNode; permanent building/object FX 7 <code>Unknown7</code> \u2014 8 <code>DynamicPerm</code> Unit permanent effects \u2192 FXB 9 <code>DamageFlameSmall</code> Building damage fire (small) 10 <code>DamageFlameSmallSmoke</code> Damage smoke 11 <code>DamageFlameLarge</code> Building damage fire (large) 12 <code>DamageSmokeOnly</code> Damage smoke only 13 <code>DamageFlameHuge</code> Building damage fire (huge) 14 <code>SpellCast</code> Legacy/unused 15 <code>SpellHitAll</code> Legacy/unused 16 <code>Hit</code> Hit point for attacks/spells 29 <code>Projectile_Spawn</code> Projectile/effect spawn point"},{"location":"drs/cgeomesh/","title":"CGeoMesh","text":"<p>The <code>CGeoMesh</code> class represents the final triangle mesh after deduplication.</p>"},{"location":"drs/cgeomesh/#structure","title":"Structure","text":"Field Type Default Description <code>magic</code> <code>uint</code> <code>1</code> Constant identifier for <code>CGeoMesh</code> <code>index_count</code> <code>uint</code> <code>0</code> Number of face indices (<code>#Faces * 3</code>) <code>faces</code> <code>List[Face]</code> \u2013 List of triangle faces (see Face) <code>vertex_count</code> <code>uint</code> \u2013 Number of vertices <code>vertices</code> <code>List[Vertex4]</code> \u2013 See Vertex (Vector4) <p>Hard limit: because faces index vertices via <code>ushort</code>, <code>vertex_count \u2264 65535</code>.</p>"},{"location":"drs/cgeomesh/#validation-rules","title":"Validation Rules","text":"Rule Description <code>magic == 1</code> Valid CGeoMesh block <code>index_count % 3 == 0</code> Triangles only <code>len(vertices) == vertex_count</code> Vertex list consistency <code>max(face indices) &lt; vertex_count</code> All indices must be within range <code>vertex_count \u2264 65535</code> Imposed by 16-bit indices"},{"location":"drs/cgeomesh/#nice-to-know","title":"Nice to know","text":"<p>NodeInformation Magic: See MagicValues \u2192 CGeoMesh.</p>"},{"location":"drs/cgeoobbtree/","title":"CGeoOBBTree (Oriented Bounding Box Tree)","text":"<p>Stores an oriented bounding box hierarchy for fast intersection/collision and a compact triangle index list. For export we use a newer OBB-fitting algorithm that can yield smaller, tighter boxes. </p>"},{"location":"drs/cgeoobbtree/#overview","title":"Overview","text":"<ul> <li>Purpose: Spatial acceleration for meshes (broad-phase tests, selection, simple collisions).</li> <li>Composition: A flat array of OBB nodes that forms a binary tree + a triangle list.</li> <li>Coordinate System: Each node carries a <code>CMatCoordinateSystem</code> (rotation basis <code>Matrix3x3</code> + position <code>Vector3</code>). See CMatCoordinateSystem. </li> </ul>"},{"location":"drs/cgeoobbtree/#cgeoobbtree","title":"CGeoOBBTree","text":"Field Type Bytes Description <code>magic</code> int32 4 1845540702 \u2014 structure magic (not NodeInformation magic). <code>version</code> int32 4 3. <code>matrix_count</code> int32 4 Number of OBB nodes. <code>obb_nodes</code> array var <code>matrix_count</code> \u00d7 OBBNode. <code>triangle_count</code> int32 4 Number of triangles listed below. <code>faces</code> array var <code>triangle_count</code> \u00d7 <code>Face</code> (3\u00d7uint16 indices). See Face. <p>Notes - The node array is stored contiguously; parent/child relationships are defined by indices. </p>"},{"location":"drs/cgeoobbtree/#obbnode","title":"OBBNode","text":"Field Type Bytes Description <code>oriented_bounding_box</code> <code>CMatCoordinateSystem</code> 48 Node\u2019s oriented box transform (rotation basis + center). <code>first_child_index</code> uint16 2 Index into the node array, or <code>0</code> if leaf. <code>second_child_index</code> uint16 2 Index into the node array, or <code>0</code> if leaf. <code>skip_pointer</code> uint16 2 Index to skip an entire subtree during traversal. <code>node_depth</code> uint16 2 Depth in the tree (root = 0). <code>triangle_offset</code> uint32 4 Start index into the global triangle list for this node\u2019s span. <code>total_triangles</code> uint32 4 Number of triangles covered by this node (leaf usually &gt; 0). <p>Leaf vs. Internal - Leaf: child indices are <code>0</code>; triangles are defined by <code>triangle_offset</code>+<code>total_triangles</code>. - Internal: child indices point to two other nodes; triangle span can be 0 at internals (implementation-dependent). </p> <p>Traversal Hints - Bounding test first: check the node\u2019s oriented box; only descend if needed. - Skip pointer: jump over a whole subtree when pruning (useful in stackless traversals).   (Exact usage is engine-dependent; the field is stored to support fast forward-jumps.) </p>"},{"location":"drs/cgeoobbtree/#conventions-constraints","title":"Conventions &amp; Constraints","text":"<ul> <li>Transform only: <code>CMatCoordinateSystem</code> carries rotation + position; no scale is encoded. Consumers assume a valid rotation basis. See Matrix3x3. </li> <li>Indices: Child pointers/skip pointer are array indices into <code>obb_nodes</code>. The tree is typically binary and stored in a layout that favors sequential reads.</li> <li>Triangle list: <code>faces</code> are shared globally for the whole tree; leaf nodes reference ranges via <code>triangle_offset</code>/<code>total_triangles</code>. <code>Face</code> = 3\u00d7uint16, 6 bytes each. </li> <li>Export note: Our exporter may use a newer OBB fitting that yields tighter boxes than legacy data. That\u2019s expected\u2014and beneficial\u2014for collision/selection.</li> </ul>"},{"location":"drs/cgeoobbtree/#cross-references","title":"Cross-references","text":"<ul> <li>Glossary: <code>MagicValues \u2192 CGeoOBBTree</code> </li> <li>Common types: <code>CMatCoordinateSystem</code>, <code>Vector3</code>, <code>Matrix3x3</code>, <code>Face</code></li> </ul>"},{"location":"drs/cgeoprimitivecontainer/","title":"CGeoPrimitiveContainer","text":"<p>The <code>CGeoPrimitiveContainer</code> class is a structural placeholder used by static objects (non-unit assets) in DRS archives. It contains no data fields of its own.</p>"},{"location":"drs/cgeoprimitivecontainer/#structure","title":"Structure","text":"Field Type Description (none) \u2013 This class is empty and has no binary content."},{"location":"drs/cgeoprimitivecontainer/#validation-rules","title":"Validation Rules","text":""},{"location":"drs/cgeoprimitivecontainer/#nice-to-know","title":"Nice to know","text":"<p>NodeInformation Magic: See MagicValues \u2192 CGeoPrimitiveContainer.</p>"},{"location":"drs/collisionshape/","title":"CollisionShape","text":"<p>Defines one or more simple collision volumes (boxes, spheres, cylinders) that describe the physical space of a static or animated object. Used mainly for hit detection, selection, and physics approximation. Each shape is positioned and rotated through its own <code>CMatCoordinateSystem</code>.</p>"},{"location":"drs/collisionshape/#overview","title":"Overview","text":"<p>A <code>CollisionShape</code> block can include multiple primitives of different types: - BoxShape \u2013 rectangular volumes (axis-aligned or oriented) - SphereShape \u2013 spherical volumes - CylinderShape \u2013 cylindrical volumes</p> <p>All primitives are stored together in one structure along with their counts.</p>"},{"location":"drs/collisionshape/#general-structure","title":"General Structure","text":"Field Type Description <code>version</code> byte Format version (usually <code>1</code>). <code>box_count</code> uint Number of box shapes. <code>boxes</code> List of BoxShape Box-shaped volumes. <code>sphere_count</code> uint Number of sphere shapes. <code>spheres</code> List of SphereShape Spherical volumes. <code>cylinder_count</code> uint Number of cylinder shapes. <code>cylinders</code> List of CylinderShape Cylindrical volumes."},{"location":"drs/collisionshape/#boxshape","title":"BoxShape","text":"<p>Represents a rectangular volume in 3D space. Consists of an oriented transform and a size definition.</p> Field Type Description <code>coord_system</code> CMatCoordinateSystem Orientation and position of the box. <code>geo_aabox</code> CGeoAABox Defines the box\u2019s dimensions via lower and upper corners. <p>Usage Used for most environment and structure collisions \u2014 simple and efficient for broad-phase physics.</p>"},{"location":"drs/collisionshape/#cgeoaabox","title":"CGeoAABox","text":"<p>Defines the axis-aligned bounding box dimensions for a box shape.</p> Field Type Description <code>lower_left_corner</code> Vector3 One corner of the box. <code>upper_right_corner</code> Vector3 Opposite corner of the box. <p>Interpretation Together, these corners define the local extents of the box relative to its coordinate system.</p>"},{"location":"drs/collisionshape/#sphereshape","title":"SphereShape","text":"<p>Represents a spherical collision volume.</p> Field Type Description <code>coord_system</code> CMatCoordinateSystem Position and orientation (only position is relevant). <code>geo_sphere</code> CGeoSphere Radius and center of the sphere."},{"location":"drs/collisionshape/#cgeosphere","title":"CGeoSphere","text":"Field Type Description <code>radius</code> float Radius of the sphere. <code>center</code> Vector3 Sphere center (usually <code>(0,0,0)</code> in local space)."},{"location":"drs/collisionshape/#cylindershape","title":"CylinderShape","text":"<p>Defines a cylindrical collision volume, useful for tall objects or units with circular bases.</p> Field Type Description <code>coord_system</code> CMatCoordinateSystem Orientation and position of the cylinder. <code>geo_cylinder</code> CGeoCylinder Geometric data (center, height, radius)."},{"location":"drs/collisionshape/#cgeocylinder","title":"CGeoCylinder","text":"Field Type Description <code>center</code> Vector3 Central point of the cylinder. <code>height</code> float Cylinder height along its local up-axis. <code>radius</code> float Radius of the base circle."},{"location":"drs/collisionshape/#concept-summary","title":"Concept Summary","text":"<ul> <li>Each primitive is defined in its own local coordinate system, enabling rotation and translation relative to the model.  </li> <li>Combined, all primitives form a compound collision volume approximating the full object shape.  </li> <li>The data structure focuses on efficiency and simplicity, not per-triangle accuracy.  </li> <li>Primarily used by static geometry or units where precise physics simulation is not needed.</li> </ul>"},{"location":"drs/collisionshape/#cross-references","title":"Cross-References","text":"<ul> <li>See CGeoMesh for visual geometry.  </li> <li>See CMatCoordinateSystem for how transformations are stored.  </li> <li>Glossary: <code>MagicValues \u2192 collisionShape</code></li> </ul> <p>--</p>"},{"location":"drs/collisionshape/#nice-to-know","title":"Nice to know","text":"<p>The node is saved as <code>collisionShape</code> with a lowercase c.</p>"},{"location":"drs/common/","title":"Common Structures","text":"<p>Canonical definitions for small, frequently reused data structures across DRS classes. These structs are referenced by multiple classes such as <code>CGeoMesh</code>, <code>CGeoSubset</code>, and <code>CGeoMaterial</code>.</p>"},{"location":"drs/common/#face","title":"Face","text":"<p>A <code>Face</code> represents a triangle defined by three 16-bit vertex indices into a mesh\u2019s <code>vertices</code> array.</p> Field Type Description <code>i0</code> <code>ushort</code> Index of first vertex (0-based) <code>i1</code> <code>ushort</code> Index of second vertex (0-based) <code>i2</code> <code>ushort</code> Index of third vertex (0-based) <p>Notes - Each face always references exactly three vertices \u2014 only triangles are supported. - Because face indices are stored as <code>ushort</code>, both the vertex index and face count are constrained by 16-bit limits.</p>"},{"location":"drs/common/#limits","title":"Limits","text":"Constraint Description <code>vertex_count \u2264 65,535</code> Maximum addressable vertex index (<code>ushort</code> limit) <code>face_count \u2264 21,845</code> Maximum number of triangles (<code>65,535 / 3 \u2248 21,845</code>) if fully packed <code>index_count = face_count * 3</code> Each face consumes three indices <p>Implications - A single mesh block can contain at most ~21 k triangles. - Larger objects must be split into multiple mesh chunks.</p>"},{"location":"drs/common/#vertex-vector4","title":"Vertex (Vector4)","text":"<p>A <code>Vertex</code> used by many classes is a 4D float vector where <code>w</code> is always <code>1.0</code>.</p> Component Type Description <code>x</code> <code>float</code> X coordinate <code>y</code> <code>float</code> Y coordinate <code>z</code> <code>float</code> Z coordinate <code>w</code> <code>float</code> Always <code>1.0</code> (homogeneous coordinate) <p>Notes - The extra component <code>w</code> exists for alignment and homogeneous transform support. - Importers typically ignore <code>w</code> since it\u2019s constant.</p>"},{"location":"drs/common/#vector3","title":"Vector3","text":"<p>A 3D point or direction, stored as three 32-bit floats (<code>x</code>, <code>y</code>, <code>z</code>). Total size: 12 bytes. </p> Component Type Bytes Notes <code>x</code> float 4 little-endian IEEE-754 <code>y</code> float 4 <code>z</code> float 4 <p>Usage Common across geometry and animation data (e.g., <code>CGeoAABox</code>, marker positions/directions, etc.). </p> <p>Constraints / Conventions - Exactly 3 floats; no padding or <code>w</code> component. - Coordinate meaning depends on the parent structure (position vs. direction). </p>"},{"location":"drs/common/#matrix3x3","title":"Matrix3x3","text":"<p>A 3\u00d73 orientation (rotation) matrix stored as 9 floats in row-major order. Total size: 36 bytes. </p> Row Elements Type Bytes 0 <code>m00 m01 m02</code> float 12 1 <code>m10 m11 m12</code> float 12 2 <code>m20 m21 m22</code> float 12 <p>Usage Represents orientation in <code>CMatCoordinateSystem</code> and other transforms. Stored/serialized as 9 consecutive floats. </p> <p>Constraints / Conventions - Intended to be a rotation basis; normalization/orthogonality is expected by readers. - Serialization is strictly 9 floats; no implicit translation. </p>"},{"location":"drs/common/#matrix4x4","title":"Matrix4x4","text":"<p>A full 4\u00d74 transform matrix stored as 16 floats in row-major order. Total size: 64 bytes. </p> Row Elements Type Bytes 0 <code>m00 m01 m02 m03</code> float 16 1 <code>m10 m11 m12 m13</code> float 16 2 <code>m20 m21 m22 m23</code> float 16 3 <code>m30 m31 m32 m33</code> float 16 <p>Usage Used where a complete affine transform is required (e.g., skeleton super-parent). Written row by row. </p> <p>Constraints / Conventions - 16 floats, no extra padding. - Meaning of the last column/row follows typical affine layout; specific interpretation depends on the consuming block. </p>"},{"location":"drs/common/#cmatcoordinatesystem","title":"CMatCoordinateSystem","text":"<p>Compact transform pairing orientation (<code>Matrix3x3</code>) with position (<code>Vector3</code>). Total size: 48 bytes (<code>36 + 12</code>). </p> Field Type Bytes Description <code>matrix</code> <code>Matrix3x3</code> 36 Rotation basis (row-major) <code>position</code> <code>Vector3</code> 12 Translation (x, y, z) <p>Usage - Core transform used by many blocks: <code>SLocator</code>, <code>OBBNode</code>, <code>BoxShape</code>, <code>CylinderShape</code>, <code>SphereShape</code>, etc. - Always serialized as 9 floats (matrix) followed by 3 floats (position). </p> <p>Constraints / Conventions - No scale component; scale is not supported. - Consumers assume the matrix encodes a valid rotation basis. </p>"},{"location":"drs/header/","title":"DRS Header &amp; Core Nodes","text":"<p>This section describes the DRS file header and the core node structures on which all class data depends. These structures form the backbone of the DRS archive layout.</p>"},{"location":"drs/header/#overview","title":"Overview","text":"Text Only<pre><code>flowchart TD\n  A[DRS Header] --&gt; B[NodeInformation[]]\n  A --&gt; C[Node[]]\n  B --&gt;|info_index| C\n  C --&gt;|name / identifier| D[Class Data Blocks]\n</code></pre> <p>Root Elements</p> <ul> <li>The first NodeInformation entry and the first Node always represent the Root Node.  </li> <li>The Root Node itself does not contain payload data \u2014 it only anchors the hierarchy.</li> </ul>"},{"location":"drs/header/#header-structure","title":"Header Structure","text":"Field Type Description <code>magic</code> <code>int</code> Constant signature value <code>-981667554</code> <code>number_of_models</code> <code>uint</code> Always <code>1</code> in BattleForge <code>node_information_offset</code> <code>uint</code> Offset where the NodeInformation section starts <code>node_hierarchy_offset</code> <code>uint</code> Offset where the Node section starts <code>node_count</code> <code>uint</code> Total number of Nodes <p>The first NodeInformation and Node entries at these offsets correspond to the Root Node.</p>"},{"location":"drs/header/#rootnodeinformation","title":"RootNodeInformation","text":"<p>Represents metadata for the Root Node and tracks how many additional nodes exist.</p> Field Type Default Description <code>zeroes[16]</code> <code>int[16]</code> <code>0</code> Spacer / padding (16\u00d70) <code>neg_one</code> <code>int</code> <code>-1</code> Unknown use, always <code>-1</code> <code>one</code> <code>uint</code> <code>1</code> Unknown use, always <code>1</code> <code>node_information_count</code> <code>uint</code> \u2013 Number of additional NodeInformation entries <code>zero</code> <code>uint</code> <code>0</code> Unknown use, always <code>0</code> <p>Tip</p> <p><code>node_information_count</code> equals <code>node_count - 1</code>, because the Root Node itself is excluded.</p>"},{"location":"drs/header/#nodeinformation","title":"NodeInformation","text":"<p>Links each Node to the data blob of its class.</p> Field Type Description <code>magic</code> <code>int</code> Unique magic number identifying the class type <code>identifier</code> <code>uint</code> References <code>Node.info_index</code> (<code>-1</code> for Root) <code>offset</code> <code>uint</code> File offset where the class data starts <code>size</code> <code>uint</code> Size of the data blob in bytes <code>unused[4]</code> <code>uint[4]</code> Four unused values (ignored in BattleForge / Skylords, used in SpellForce 2)"},{"location":"drs/header/#root-node-first-entry-in-node-hierarchy","title":"Root Node (first entry in Node hierarchy)","text":"Field Type Default Description <code>identifier</code> <code>uint</code> <code>0</code> Identifier of the Root Node <code>unknown</code> <code>uint</code> <code>0</code> Unknown, always zero <code>length</code> <code>uint</code> <code>9</code> Length of the string <code>\"root_node\"</code> <code>name</code> <code>str</code> <code>\"root_node\"</code> Name of the Root Node <p>The Root Node always has identifier <code>0</code> and name <code>\"root_node\"</code>. It precedes all other class nodes in the hierarchy.</p>"},{"location":"drs/header/#node-generic-hierarchy-entry","title":"Node (generic hierarchy entry)","text":"<p>Each Node represents a link between a class name and its corresponding NodeInformation entry. Every Node ends with a zero integer used as a spacer.</p> Field Type Description <code>info_index</code> <code>uint</code> Index into the NodeInformation table (<code>-1</code> for Root) <code>length</code> <code>uint</code> Length of the class name string <code>name</code> <code>str</code> The class name <code>zero</code> <code>uint</code> Always <code>0</code> (spacer)"},{"location":"drs/header/#validation-rules","title":"Validation Rules","text":"Rule Description <code>Header.magic == -981667554</code> Validates file signature <code>Header.node_count &gt;= 1</code> At least one node (Root) must exist <code>RootNode.identifier == 0</code> and <code>RootNode.name == \"root_node\"</code> Root node consistency <code>len(NodeInformation) == Header.node_count - 1</code> Node counts must match (<code>-1</code> for RootNodeInformation) Each <code>Node.info_index &gt;= 0</code> Must reference valid NodeInformation (except Root) No overlapping <code>offset</code>/<code>size</code> pairs Class data blocks must not overlap"},{"location":"drs/header/#known-variants","title":"Known Variants","text":"Game / Version Notes BattleForge / Skylords Reborn <code>unused[4]</code> fields are unused; <code>number_of_models</code> is always <code>1</code>. SpellForce 2 DRS <code>unused[4]</code> were used to override settings for certain assets."},{"location":"drs/header/#summary","title":"Summary","text":"<p>The DRS Header defines where all structural blocks of the archive begin. From there, each NodeInformation and Node entry establishes the relationship between class metadata and data payloads. Understanding this hierarchy is essential before parsing any of the 15 class structures that follow.</p>"}]}